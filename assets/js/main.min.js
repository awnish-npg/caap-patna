function showLoader(){$("body").append('<div id="loader-wrapper"><div id="loader"><\/div><div class="loader-section section-left"><\/div><div class="loader-section section-right"><\/div><\/div>').removeClass("loaded").addClass("loading")}function add_loader(n){$(n).waitMe({effect:"bounce",text:"",color:"#000",maxSize:"",waitTime:-1,textPos:"vertical",fontSize:"",source:"",onClose:function(){}})}function _make_task_checklist_items_deletable(){if(app.options.has_permission_tasks_checklist_items_delete=="1"){var n=$("body").find(".checklist-templates-wrapper ul.dropdown-menu li").not(":first-child"),t=$("body").find(".checklist-templates-wrapper select option").not(":first-child");$.each(t,function(t,i){var r=$(i);$(n[t]).find(".checklist-item-template-remove").length===0&&$(n[t]).find("a > span.text").after('<small class="checklist-item-template-remove" onclick="remove_checklist_item_template('+r.attr("value")+'); event.stopPropagation();"><i class="fa fa-remove"><\/i><\/small>')})}}function _init_tasks_billable_select(n,t){var r=$("#task_select"),u,i,f;r.length>0&&(r.find("option").filter(function(){return this.value||$.trim(this.value).length>0||$.trim(this.text).length>0}).remove(),$.each(n,function(n,t){u=" ";t.started_timers===!0?u+='disabled class="text-danger important" data-subtext="'+app.lang.invoice_task_billable_timers_found+'"':t.started_timers===!1&&t.rel_type!="project"&&(u+='data-subtext="'+t.rel_name+'"');r.append('<option value="'+t.id+'"'+u+">"+t.name+"<\/option>")}),i=$(".input-group-addon-bill-tasks-help"),i.find(".popover-invoker").popover("destroy"),i.empty(),f="",f=empty(t)?app.lang.invoice_task_item_project_tasks_not_included:app.lang.showing_billable_tasks_from_project+" "+$("#project_id option:selected").text().trim(),i.html('<span class="pointer popover-invoker" data-container=".form-group-select-task_select" data-trigger="click" data-placement="top" data-toggle="popover" data-content="'+f+'"><i class="fa fa-question-circle"><\/i><\/span>'),delay(function(){(i.attr("info-shown-count")<3||typeof i.attr("info-shown-count")=="undefined")&&$(".projects-wrapper").is(":visible")&&n.length>0&&(i.attr("info-shown-count",typeof i.attr("info-shown-count")=="undefined"?1:parseInt(i.attr("info-shown-count"))+1),i.find(".popover-invoker").click())},3500));r.selectpicker("refresh")}function mainWrapperHeightFix(){var n=63,t=side_bar.height(),i=$("#wrapper").find(".content").height();setup_menu.css("min-height",$(document).outerHeight(!0)-n*2+"px");content_wrapper.css("min-height",$(document).outerHeight(!0)-n+"px");i<t&&content_wrapper.css("min-height",t+"px");i<t&&t<$(window).height()&&content_wrapper.css("min-height",$(window).height()-n+"px");i>t&&i<$(window).height()&&content_wrapper.css("min-height",$(window).height()-n+"px");is_mobile()&&isRTL=="true"&&side_bar.css("min-height",$(document).outerHeight(!0)-n+"px")}function set_body_small(){$(this).width()<769?$("body").addClass("page-small"):$("body").removeClass("page-small show-sidebar")}function switch_field(n){var t,i,r;t=0;$(n).prop("checked")===!0&&(t=1);i=$(n).data("switch-url");r=$(n).data("id");requestGet(i+"/"+r+"/"+t)}function _validate_form(n,t,i,r){appValidateForm(n,t,i,r)}function delete_option(n,t){confirm_delete()&&requestGetJSON("settings/delete_option/"+t).done(function(t){(t.success===!0||t.success=="true")&&$(n).parents(".option").remove()})}function init_rel_tasks_table(n,t,i){var r,u,f,o,e;(typeof i=="undefined"&&(i=".table-rel-tasks"),r=$("body").find(i),r.length!==0)&&(u={},f=[0],o=$("body").find("._hidden_inputs._filters._tasks_filters input"),$.each(o,function(){u[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),e=admin_url+"tasks/init_relation_tasks/"+n+"/"+t,r.attr("data-new-rel-type")=="project"&&(e+="?bulk_actions=true"),initDataTable(r,e,f,f,u,[r.find("th.duedate").index(),"asc"]))}function initDataTableInline(n){appDataTableInline(n,{supportsButtons:!0,supportsLoading:!0,autoWidth:!1,scrollResponsive:app.options.scroll_responsive_tables})}function initDataTable(n,t,i,r,u,f,e,o){var s=typeof n=="string"?$("body").find("table"+n):n,p,a,v,w,h,c,y,d,l;if(s.length===0)return!1;if(u=u=="undefined"||typeof u=="undefined"?[]:u,typeof f=="undefined"?f=[[0,"asc"]]:f.length===1&&(f=[f]),p=s.attr("data-default-order"),!empty(p)){a=JSON.parse(p);v=[];for(w in a)s.find("thead th:eq("+a[w][0]+")").length>0&&v.push(a[w]);v.length>0&&(f=v)}h=[10,25,50,100];c=[10,25,50,100];app.options.tables_pagination_limit=parseFloat(app.options.tables_pagination_limit);$.inArray(app.options.tables_pagination_limit,h)==-1&&(h.push(app.options.tables_pagination_limit),c.push(app.options.tables_pagination_limit));h.sort(function(n,t){return n-t});c.sort(function(n,t){return n-t});h.push(-1);c.push(app.lang.dt_length_menu_all);e==""&&(e=-1);e!=undefined&&(app.options.tables_pagination_limit=e);o==undefined&&(o=[]);console.log("PAGINATION_INFO",typeof PAGINATION_INFO);typeof PAGINATION_INFO!="undefined"&&(app.lang.datatables.info=PAGINATION_INFO);y={language:app.lang.datatables,processing:!1,retrieve:!0,serverSide:!0,paginate:!0,searchDelay:750,bDeferRender:!0,responsive:!0,autoWidth:!1,dom:"<'row'><'row'<'col-md-7'lB><'col-md-5'f>>rt<'row table-footer'<'col-md-7'i><'col-md-5'<'#colvis'><'.dt-page-jump'>p>>",pageLength:app.options.tables_pagination_limit,lengthMenu:[h,c],columns:o,columnDefs:[{searchable:!1,targets:i},{sortable:!1,targets:r},],fnDrawCallback:function(n){n.aoData.length===0?($(n.nTableWrapper).addClass("app_dt_empty"),$(".buttons-collection").prop("disabled",!0)):$(n.nTableWrapper).removeClass("app_dt_empty")},fnCreatedRow:function(n,t){$(n).attr("data-title",t.Data_Title);$(n).attr("data-toggle",t.Data_Toggle)},initComplete:function(){var n=this,f=$(".btn-dt-reload"),t,i,r,u;f.attr("data-toggle","tooltip");f.attr("title",app.lang.dt_button_reload);t=$(".dt-column-visibility");t.attr("data-toggle","tooltip");t.attr("title",app.lang.dt_button_column_visibility);(n.hasClass("scroll-responsive")||app.options.scroll_responsive_tables==1)&&n.wrap('<div class="table-responsive"><\/div>');i=n.find(".dataTables_empty");i.length&&i.attr("colspan",n.find("thead th").length);is_mobile()&&$(window).width()<400&&n.find('tbody td:first-child input[type="checkbox"]').length>0&&(n.DataTable().column(0).visible(!1,!1).columns.adjust(),$("a[data-target*='bulk_actions']").addClass("hide"));n.parents(".table-loading").removeClass("table-loading");n.removeClass("dt-table-loading");r=n.find("thead th:last-child");u=n.find("thead th:first-child");r.text().trim()==app.lang.options&&r.addClass("not-export");u.find('input[type="checkbox"]').length>0&&u.addClass("not-export");mainWrapperHeightFix()},order:f,ajax:{url:t,type:"POST",data:function(n){typeof csrfData!="undefined"&&(n[csrfData.token_name]=csrfData.hash);for(var t in u)n[t]=$(u[t]).val();s.attr("data-last-order-identifier")&&(n.last_order_identifier=s.attr("data-last-order-identifier"))}},buttons:get_datatable_buttons(s)};(s.hasClass("scroll-responsive")||app.options.scroll_responsive_tables==1)&&(y.responsive=!1);console.log(y);s=s.dataTable(y);var b=s.DataTable(),g=s.find("th.not_visible"),k=[];if($.each(g,function(){k.push(this.cellIndex)}),setTimeout(function(){for(var n in k)b.columns(k[n]).visible(!1,!1).columns.adjust()},10),s.hasClass("customizable-table")){d=s.find("th.toggleable");l=$("#hidden-columns-"+s.attr("id"));try{l=JSON.parse(l.text())}catch(nt){l=[]}$.each(d,function(){var n=$(this).attr("id");$.inArray(n,l)>-1&&b.column("#"+n).visible(!1)})}s.is(":hidden")&&s.find(".dataTables_empty").attr("colspan",s.find("thead th").length);s.on("preXhr.dt",function(n,t){t.jqXHR&&t.jqXHR.abort()});return b}function task_single_update_tags(){var n=$("#taskTags");$.post(admin_url+"tasks/update_tags",{tags:n.tagit("assignedTags"),task_id:n.attr("data-taskid")})}function task_attachments_toggle(){var n=$("#task-modal");n.find(".task_attachments_wrapper .task-attachments-more").toggleClass("hide");n.find(".task_attachments_wrapper .task-attachments-less").toggleClass("hide")}function update_todo_items(){var n=$(".unfinished-todos li:not(.no-todos)"),t=$(".finished-todos li:not(.no-todos)"),r=1,i;$.each(n,function(){$(this).find('input[name="todo_order"]').val(r);$(this).find('input[name="finished"]').val(0);r++});n.length===0?($(".nav-total-todos").addClass("hide"),$(".unfinished-todos li.no-todos").removeClass("hide")):n.length>0&&($(".unfinished-todos li.no-todos").hasClass("hide")||$(".unfinished-todos li.no-todos").addClass("hide"),$(".nav-total-todos").removeClass("hide").html(n.length));x=1;$.each(t,function(){$(this).find('input[name="todo_order"]').val(x);$(this).find('input[name="finished"]').val(1);$(this).find('input[type="checkbox"]').prop("checked",!0);r++;x++});t.length===0?$(".finished-todos li.no-todos").removeClass("hide"):t.length>0&&($(".finished-todos li.no-todos").hasClass("hide")||$(".finished-todos li.no-todos").addClass("hide"));i=[];$.each(n,function(){var n=$(this).find(".todo-description");n.hasClass("line-throught")&&n.removeClass("line-throught");$(this).find('input[type="checkbox"]').prop("checked",!1);i.push([$(this).find('input[name="todo_id"]').val(),$(this).find('input[name="todo_order"]').val(),$(this).find('input[name="finished"]').val(),])});$.each(t,function(){var n=$(this).find(".todo-description");n.hasClass("line-throught")||n.addClass("line-throught");i.push([$(this).find('input[name="todo_id"]').val(),$(this).find('input[name="todo_order"]').val(),$(this).find('input[name="finished"]').val(),])});data={};data.data=i;$.post(admin_url+"todo/update_todo_items_order",data)}function delete_todo_item(n,t){requestGetJSON("todo/delete_todo_item/"+t).done(function(t){(t.success===!0||t.success=="true")&&($(n).parents("li").remove(),update_todo_items())})}function edit_todo_item(n){requestGetJSON("todo/get_by_id/"+n).done(function(n){var t=$("#__todo");t.find('input[name="todoid"]').val(n.todoid);t.find('textarea[name="description"]').val(n.description);t.modal("show")})}function init_datepicker(n,t){appDatepicker({element_date:n,element_time:t})}function init_color_pickers(){appColorPicker()}function init_selectpicker(){appSelectPicker()}function init_lightbox(){appLightbox()}function init_progress_bars(){appProgressBar()}function init_tags_inputs(){appTagsInput()}function dt_custom_view(n,t,i,r){var u=typeof i=="undefined"?"custom_view":i,f,e;typeof r!="undefined"&&(f=$("._filter_data li.active").not(".clear-all-prevent"),f.removeClass("active"),$.each(f,function(){var n=$(this).find("a").attr("data-cview");$('._filters input[name="'+n+'"]').val("")}));e=do_filter_active(u);e!=u&&(n="");$('input[name="'+u+'"]').val(n);$(t).DataTable().ajax.reload()}function do_filter_active(n,t){var r,i,f,u;return n!==""&&typeof n!="undefined"?($('[data-cview="all"]').parents("li").removeClass("active"),r=$('[data-cview="'+n+'"]'),typeof t!="undefined"&&(r=$(t+' [data-cview="'+n+'"]')),i=r.parents("li"),i.hasClass("filter-group")&&(f=i.data("filter-group"),$('[data-filter-group="'+f+'"]').not(i).removeClass("active"),$.each($('[data-filter-group="'+f+'"]').not(i),function(){$('input[name="'+$(this).find("a").attr("data-cview")+'"]').val("")})),i.not(".dropdown-submenu").hasClass("active")?(i.not(".dropdown-submenu").removeClass("active"),u=r.parents("li.dropdown-submenu"),u.length>0&&u.find("li.active").length===0&&u.removeClass("active"),n=""):i.addClass("active"),n):($("._filters input").val(""),$("._filter_data li.active").removeClass("active"),$('[data-cview="all"]').parents("li").addClass("active"),"")}function init_roles_permissions(n,t){var r,i;(n=typeof n=="undefined"?$('select[name="role"]').val():n,r=$('.member > input[name="isedit"]'),r.length>0&&typeof n!="undefined"&&typeof t=="undefined")||$('input[name="administrator"]').prop("checked")!==!0&&n!==""&&(i=$("table.roles").find("tr"),requestGetJSON("staff/role_changed/"+n).done(function(n){i.find(".capability").not('[data-not-applicable="true"]').prop("checked",!1).trigger("change");$.each(i,function(){var t=$(this);$.each(n,function(n,i){t.data("name")==n&&$.each(i,function(i,r){t.find('input[id="'+n+"_"+r+'"]').prop("checked",!0);r=="view"?t.find("[data-can-view]").change():r=="view_own"&&t.find("[data-can-view-own]").change()})})})}))}function toggle_small_view(n,t){var i,r,u;($("body").toggleClass("small-table"),i=$("#small-table"),i.length!==0)&&(r=!1,i.hasClass("col-md-5")?(i.removeClass("col-md-5").addClass("col-md-12"),r=!0,$(".toggle-small-view").find("i").removeClass("fa fa-angle-double-right").addClass("fa fa-angle-double-left")):(i.addClass("col-md-5").removeClass("col-md-12"),$(".toggle-small-view").find("i").removeClass("fa fa-angle-double-left").addClass("fa fa-angle-double-right")),u=$(n).DataTable(),u.columns(hidden_columns).visible(r,!1),u.columns.adjust(),$(t).toggleClass("hide"),$(window).trigger("resize"))}function logout(){var i=$(".started-timers-top").find("li.timer").length,n,t;if(i>0)return n=$("#timers-logout-template-warning").html(),t=system_popup({message:" ",content:n}),t.find(".popup-message").addClass("hide"),!1;window.location.href=admin_url+"authentication/logout"}function showChangePass(){$("#change_pass").modal("show")}function elFinderBrowser(n,t,i,r){return tinymce.activeEditor.windowManager.open({file:admin_url+"misc/tinymce_file_browser",title:app.lang.media_files,width:900,height:450,resizable:"yes"},{setUrl:function(t){r.document.getElementById(n).value=t}}),!1}function init_editor(n,t){var u,i,r,f;if(n=typeof n=="undefined"?".tinymce":n,u=$(n),u.length!==0){if($.each(u,function(){$(this).hasClass("tinymce-manual")&&$(this).removeClass("tinymce")}),i={branding:!1,selector:n,browser_spellcheck:!0,height:400,theme:"modern",skin:"perfex",language:app.tinymce_lang,relative_urls:!1,inline_styles:!0,verify_html:!1,cleanup:!1,autoresize_bottom_margin:25,valid_elements:"+*[*]",valid_children:"+body[style], +style[type]",apply_source_formatting:!1,remove_script_host:!1,removed_menuitems:"newdocument restoredraft",forced_root_block:!1,autosave_restore_when_empty:!1,fontsize_formats:"8pt 10pt 12pt 14pt 18pt 24pt 36pt",setup:function(n){n.on("init",function(){this.getDoc().body.style.fontSize="12pt"})},table_default_styles:{width:"100%"},plugins:["advlist autoresize autosave lists link image print hr codesample","visualblocks code fullscreen","media save table contextmenu","paste textcolor colorpicker",],toolbar1:"fontselect fontsizeselect | forecolor backcolor | bold italic | alignleft aligncenter alignright alignjustify | image link | bullist numlist | restoredraft",file_browser_callback:elFinderBrowser},isRTL=="true"?i.directionality="rtl":"",isRTL=="true"?i.plugins[0]+=" directionality":"",typeof t!="undefined")for(r in t)r!="append_plugins"?i[r]=t[r]:i.plugins.push(t[r]);return f=tinymce.init(i),$(document).trigger("app.editor.initialized"),f}}function _formatMenuIconInput(n){if(typeof n!="undefined"){var t=$(n.target);t.val().match(/^fa /)||t.val("fa "+t.val())}}function init_btn_with_tooltips(){var n,t,i;if(is_mobile()){if(n=navigator.userAgent.match(/iPad/i)!=null,n)return!1;t=$("._buttons").find(".btn-with-tooltip");$.each(t,function(){var n=$(this).attr("title");typeof n=="undefined"&&(n=$(this).attr("data-title"));typeof n!="undefined"&&($(this).append(" "+n),$(this).removeClass("btn-with-tooltip"))});i=$("._buttons").find(".btn-with-tooltip-group");$.each(i,function(){var n=$(this).attr("title");typeof n=="undefined"&&(n=$(this).attr("data-title"));typeof n!="undefined"&&($(this).find(".btn").eq(0).append(" "+n),$(this).removeClass("btn-with-tooltip-group"))})}}function do_hash_helper(n){if(typeof history.pushState!="undefined"){var i=window.location.href,t={Url:i};history.pushState(t,"",t.Url);window.location.hash=n}}function init_form_reminder(n){var t=n?$("#form-reminder-"+n):$('[id^="form-reminder-"]');$.each(t,function(n,t){$(t).appFormValidator({rules:{date:"required",staff:"required",description:"required"},submitHandler:reminderFormHandler})})}function new_task_reminder(n){var t=$("#newTaskReminderToggle");!t.is(":visible")||t.is(":visible")&&t.attr("data-edit")!=undefined?(t.slideDown(400,function(){fix_task_modal_left_col_height()}),$("#taskReminderFormSubmit").html(app.lang.create_reminder),t.find("form").attr("action",admin_url+"tasks/add_reminder/"+n),t.find("#description").val(""),t.find("#date").val(""),t.find("#staff").selectpicker("val",t.find("#staff").attr("data-current-staff")),t.find("#notify_by_email").prop("checked",!1),t.attr("data-edit")!=undefined&&t.removeAttr("data-edit"),t.isInViewport()||$("#task-modal").animate({scrollTop:t.offset().top+"px"},"fast")):t.slideUp()}function edit_reminder(n){requestGetJSON("misc/get_reminder/"+n).done(function(t){var i=$(".reminder-modal-"+t.rel_type+"-"+t.rel_id),r=admin_url+"misc/edit_reminder/"+n;i.length===0&&$("body").hasClass("all-reminders")?(i=$(".reminder-modal--"),i.find('input[name="rel_type"]').val(t.rel_type),i.find('input[name="rel_id"]').val(t.rel_id)):$("#task-modal").is(":visible")&&(i=$("#newTaskReminderToggle"),i.attr("data-edit")&&i.attr("data-edit")==n?(i.slideUp(),i.removeAttr("data-edit")):(i.slideDown(400,function(){fix_task_modal_left_col_height()}),i.attr("data-edit",n),i.isInViewport()||$("#task-modal").animate({scrollTop:i.offset().top+"px"},"fast")),r=admin_url+"tasks/edit_reminder/"+n,$("#taskReminderFormSubmit").html(app.lang.save));i.find("form").attr("action",r);i.find("form").attr("data-edit",!0);i.find("#description").val(t.description);i.find("#date").val(t.date);i.find("#staff").selectpicker("val",t.staff);i.find("#notify_by_email").prop("checked",t.notify_by_email==1?!0:!1);i.hasClass("modal")&&i.modal("show")})}function reminderFormHandler(n){n=$(n);var t=n.serialize();return $.post(n.attr("action"),t).done(function(t){t=JSON.parse(t);t.message!==""&&alert_float(t.alert_type,t.message);n.trigger("reinitialize.areYouSure");$("#task-modal").is(":visible")&&_task_append_html(t.taskHtml);reload_reminders_tables()}),$("body").hasClass("all-reminders")?$(".reminder-modal--").modal("hide"):$(".reminder-modal-"+n.find('[name="rel_type"]').val()+"-"+n.find('[name="rel_id"]').val()).modal("hide"),!1}function reload_reminders_tables(){$.each([".table-reminders",".table-reminders-leads",".table-my-reminders",],function(n,t){$.fn.DataTable.isDataTable(t)&&$("body").find(t).DataTable().ajax.reload()})}function toggle_edit_note(n){$("body").find('[data-note-edit-textarea="'+n+'"]').toggleClass("hide");$("body").find('[data-note-description="'+n+'"]').toggleClass("hide")}function edit_note(n){var t=$("body").find('[data-note-edit-textarea="'+n+'"] textarea').val();t!==""&&($.post(admin_url+"misc/edit_note/"+n,{description:t}).done(function(i){i=JSON.parse(i);(i.success===!0||i.success=="true")&&(alert_float("success",i.message),$("body").find('[data-note-description="'+n+'"]').html(nl2br(t)))}),toggle_edit_note(n))}function toggle_file_visibility(n,t,i){requestGet("misc/toggle_file_visibility/"+n).done(function(n){n==1?$(i).find("i").removeClass("fa fa-toggle-off").addClass("fa fa-toggle-on"):$(i).find("i").removeClass("fa fa-toggle-on").addClass("fa fa-toggle-off")})}function fix_kanban_height(n,t){var i,r;$("body").find("div.dt-loader").remove();i=$(".kan-ban-content-wrapper");i.css("max-height",window.innerHeight-n+"px");$(".kan-ban-content").css("min-height",window.innerHeight-n+"px");r=parseInt(i.length);$(".container-fluid").css("min-width",r*t+"px")}function kanban_load_more(n,t,i,r,u){var f=[],h=$('input[name="search"]').val(),o,e=$(t).attr("data-page"),c=$('[data-col-status-id="'+n+'"]').data("total-pages"),s,l;e<=c&&(s=$('input[name="sort_type"]'),l=$('input[name="sort"]').val(),s.length!=0&&s.val()!==""&&(f.sort_by=s.val(),f.sort=l),typeof h!="undefined"&&h!==""&&(f.search=h),$.each($("#kanban-params input"),function(){o=$(this).attr("type")=="checkbox"?$(this).prop("checked")===!0?$(this).val():"":$(this).val();o!==""&&(f[$(this).attr("name")]=o)}),f.status=n,f.page=e,f.page++,requestGet(buildUrl(admin_url+i,f)).done(function(i){e++;$('[data-load-status="'+n+'"]').before(i);$(t).attr("data-page",e);fix_kanban_height(r,u)}).fail(function(n){alert_float("danger",n.responseText)}),e>=c-1&&$(t).addClass("disabled"))}function check_kanban_empty_col(n){var t=$("[data-col-status-id]");$.each(t,function(t,i){var r=$(i).find(n).length;r==0?($(i).find(".kanban-empty").removeClass("hide"),$(i).find(".kanban-load-more").addClass("hide")):$(i).find(".kanban-empty").addClass("hide")})}function init_kanban(n,t,i,r,u,f){var e,o,s,h,c;$("#kan-ban").length!==0&&(e=[],$.each($("#kanban-params input"),function(){o=$(this).attr("type")=="checkbox"?$(this).prop("checked")===!0?$(this).val():"":$(this).val();o!==""&&(e[$(this).attr("name")]=o)}),s=$('input[name="search"]').val(),typeof s!="undefined"&&s!==""&&(e.search=s),h=$('input[name="sort_type"]'),c=$('input[name="sort"]').val(),h.length!=0&&h.val()!==""&&(e.sort_by=h.val(),e.sort=c),e.kanban=!0,n=admin_url+n,n=buildUrl(n,e),delay(function(){$("body").append('<div class="dt-loader"><\/div>');$("#kan-ban").load(n,function(){fix_kanban_height(r,u);var n=20,e=60;typeof f!="undefined"&&f();$(".status").sortable({connectWith:i,helper:"clone",appendTo:"#kan-ban",placeholder:"ui-state-highlight-card",revert:"invalid",scrollingSensitivity:50,scrollingSpeed:70,sort:function(t,i){var r=i.placeholder[0].parentNode,u;r=$(r).parents(".kan-ban-content-wrapper")[0];u=$(r).offset();u.top+r.offsetHeight-t.pageY<n?r.scrollTop=r.scrollTop+e:t.pageY-u.top<n&&(r.scrollTop=r.scrollTop-e);u.left+r.offsetWidth-t.pageX<n?r.scrollLeft=r.scrollLeft+e:t.pageX-u.left<n&&(r.scrollLeft=r.scrollLeft-e)},change:function(){var n=$(this).closest("ul"),t=$(n).find(".kanban-load-more");$(n).append($(t).detach())},start:function(n,t){$("body").css("overflow","hidden");$(t.helper).addClass("tilt");$(t.helper).find(".panel-body").css("background","#fbfbfb");tilt_direction($(t.helper))},stop:function(n,t){$("body").removeAttr("style");$(t.helper).removeClass("tilt");$("html").off("mousemove",$(t.helper).data("move_handler"));$(t.helper).removeData("move_handler")},update:function(n,i){t(i,this)}});$(".status").sortable({cancel:".not-sortable"})})},200))}function kan_ban_sort(n,t){var u=$('input[name="sort_type"]'),i,r;u.val(n);i=$('input[name="sort"]');r=i.val().toLowerCase();i.val(r=="asc"?"DESC":"ASC");init_kan_ban_sort_icon(i.val(),n);t()}function init_kan_ban_sort_icon(n,t){$("body").find(".kanban-sort-icon").remove();$("body").find("."+t).prepend(" <i class='kanban-sort-icon fa fa-sort-amount-"+n.toLowerCase()+"'><\/i>")}function init_newsfeed_form(){if(typeof newsFeedDropzone=="undefined")$("body").on("submit","#new-post-form",function(){return $.post(this.action,$(this).serialize()).done(function(n){if(n=JSON.parse(n),n.postid){if(newsFeedDropzone.getQueuedFiles().length>0){newsFeedDropzone.options.url=admin_url+"newsfeed/add_post_attachments/"+n.postid;newsFeedDropzone.processQueue();return}newsfeed_new_post(n.postid);clear_newsfeed_post_area()}}),!1});newsFeedDropzone=new Dropzone("#new-post-form",appCreateDropzoneOptions({clickable:".add-post-attachments",autoProcessQueue:!1,addRemoveLinks:!0,parallelUploads:app.options.newsfeed_maximum_files_upload,maxFiles:app.options.newsfeed_maximum_files_upload,dragover:function(){$("#new-post-form").addClass("dropzone-active")},complete:function(){},drop:function(){$("#new-post-form").removeClass("dropzone-active")},success:function(n,t){this.getUploadingFiles().length===0&&this.getQueuedFiles().length===0&&(t=JSON.parse(t),newsfeed_new_post(t.postid),clear_newsfeed_post_area(),this.removeAllFiles())}}))}function clear_newsfeed_post_area(){$("#new-post-form textarea").val("");$("#post-visibility").selectpicker("deselectAll")}function load_post_likes(n){track_load_post_likes<=post_likes_total_pages&&($.post(admin_url+"newsfeed/load_likes_modal",{page:track_load_post_likes,postid:n}).done(function(n){track_load_post_likes++;$("#modal_post_likes_wrapper").append(n)}),track_load_post_likes>=post_likes_total_pages-1&&$(".likes_modal .modal-footer").addClass("hide"))}function load_comment_likes(n){track_load_comment_likes<=comment_likes_total_pages&&($.post(admin_url+"newsfeed/load_comment_likes_model",{page:track_load_comment_likes,commentid:n}).done(function(n){track_load_comment_likes++;$("#modal_comment_likes_wrapper").append(n)}),track_load_comment_likes>=comment_likes_total_pages-1&&$(".likes_modal .modal-footer").addClass("hide"))}function load_more_comments(n){var i=$(n).data("postid"),t=$(n).find('input[name="page"]').val(),r=$(n).data("total-pages");t<=r&&($.post(admin_url+"newsfeed/init_post_comments/"+i,{page:t}).done(function(r){$(n).data("track-load-comments",t);$('[data-comments-postid="'+i+'"] .load-more-comments').before(r)}),t++,$(n).find('input[name="page"]').val(t),t>=r-1&&($(n).addClass("hide"),$(n).removeClass("display-block")))}function newsfeed_new_post(n){var t={};t.postid=n;$.post(admin_url+"newsfeed/load_newsfeed",t).done(function(n){var r=$("#newsfeed_data").find(".pinned"),t=r.length,i;t===0?$("#newsfeed_data").prepend(n):(i=$("#newsfeed_data").find(".pinned").eq(t-1),$(i).after(n))})}function load_newsfeed(n){var t={},i;t.page=newsfeed_posts_page;typeof n!="undefined"&&n!=0&&(t.postid=n);i=$('input[name="total_pages_newsfeed"]').val();newsfeed_posts_page<=i&&($.post(admin_url+"newsfeed/load_newsfeed",t).done(function(n){newsfeed_posts_page++;$("#newsfeed_data").append(n)}),newsfeed_posts_page>=i-1)}function like_post(n){requestGetJSON("newsfeed/like_post/"+n).done(function(t){(t.success===!0||t.success=="true")&&refresh_post_likes(n)})}function unlike_post(n){requestGetJSON("newsfeed/unlike_post/"+n).done(function(t){(t.success===!0||t.success=="true")&&refresh_post_likes(n)})}function like_comment(n,t){requestGetJSON("newsfeed/like_comment/"+n+"/"+t).done(function(t){(t.success===!0||t.success=="true")&&$('[data-commentid="'+n+'"]').replaceWith(t.comment)})}function unlike_comment(n,t){requestGetJSON("newsfeed/unlike_comment/"+n+"/"+t).done(function(t){(t.success===!0||t.success=="true")&&$('[data-commentid="'+n+'"]').replaceWith(t.comment)})}function add_comment(n){var t=$(n).data("postid");$.post(admin_url+"newsfeed/add_comment",{content:$(n).val(),postid:t}).done(function(i){i=JSON.parse(i);(i.success===!0||i.success=="true")&&($(n).val(""),$("body").find('[data-comments-postid="'+t+'"] .post-comment').length>0?$("body").find('[data-comments-postid="'+t+'"] .post-comment').prepend(i.comment):refresh_post_comments(t))})}function remove_post_comment(n,t){requestGetJSON("newsfeed/remove_post_comment/"+n+"/"+t).done(function(t){(t.success===!0||t.success=="true")&&$('.comment[data-commentid="'+n+'"]').remove()})}function refresh_post_likes(n){requestGet("newsfeed/init_post_likes/"+n+"?refresh_post_likes=true").done(function(t){$('[data-likes-postid="'+n+'"]').html(t)})}function refresh_post_comments(n){$.post(admin_url+"newsfeed/init_post_comments/"+n+"?refresh_post_comments=true").done(function(t){$('[data-comments-postid="'+n+'"]').html(t)})}function delete_post(n){confirm_delete()&&$.post(admin_url+"newsfeed/delete_post/"+n,function(t){(t.success===!0||t.success=="true")&&$('[data-main-postid="'+n+'"]').remove()},"json")}function pin_post(n){requestGetJSON("newsfeed/pin_newsfeed_post/"+n).done(function(n){(n.success===!0||n.success=="true")&&window.location.reload()})}function unpin_post(n){requestGetJSON("newsfeed/unpin_newsfeed_post/"+n).done(function(n){(n.success===!0||n.success=="true")&&window.location.reload()})}function _gen_lead_add_inline_on_select_field(n){var t="";($("body").hasClass("leads-email-integration")||$("body").hasClass("web-to-lead-form"))&&(n="lead_"+n);t='<div id="new_lead_'+n+'_inline" class="form-group"><label for="new_'+n+'_name">'+$('label[for="'+n+'"]').html().trim()+'<\/label><div class="input-group"><input type="text" id="new_'+n+'_name" name="new_'+n+'_name" class="form-control"><div class="input-group-addon"><a href="#" onclick="lead_add_inline_select_submit(\''+n+'\'); return false;" class="lead-add-inline-submit-'+n+'"><i class="fa fa-check"><\/i><\/a><\/div><\/div><\/div>';$(".form-group-select-input-"+n).after(t);$("body").find("#new_"+n+"_name").focus();$('.lead-save-btn,#form_info button[type="submit"],#leads-email-integration button[type="submit"],.btn-import-submit').prop("disabled",!0);$(".inline-field-new").addClass("disabled").css("opacity",.5);$(".form-group-select-input-"+n).addClass("hide")}function new_lead_status_inline(){_gen_lead_add_inline_on_select_field("status")}function new_lead_source_inline(){_gen_lead_add_inline_on_select_field("source")}function lead_add_inline_select_submit(n){var r=$("#new_"+n+"_name").val().trim(),t,i;r!==""&&(t=n,n.indexOf("lead_")>-1&&(t=t.replace("lead_","")),i={},i.name=r,i.inline=!0,$.post(admin_url+"leads/"+t,i).done(function(t){if(t=JSON.parse(t),t.success===!0||t.success=="true"){var i=$("body").find("select#"+n);i.append('<option value="'+t.id+'">'+r+"<\/option>");i.selectpicker("val",t.id);i.selectpicker("refresh");i.parents(".form-group").removeClass("has-error")}}));$("#new_lead_"+n+"_inline").remove();$(".form-group-select-input-"+n).removeClass("hide");$('.lead-save-btn,#form_info button[type="submit"],#leads-email-integration button[type="submit"],.btn-import-submit').prop("disabled",!1);$(".inline-field-new").removeClass("disabled").removeAttr("style")}function init_lead(n,t){$("#task-modal").is(":visible")&&$("#task-modal").modal("hide");init_lead_modal_data(n,undefined,t)&&$("#lead-modal").modal("show")}function validate_lead_form(){var n={name:"required",source:"required",status:{required:{depends:function(){return $("[lead-is-junk-or-lost]").length>0?!1:!0}}}},t={};$.each(leadUniqueValidationFields,function(i,r){n[r]={};r=="email"&&(n[r].email=!0);n[r].remote={url:admin_url+"leads/validate_unique_field",type:"post",data:{field:r,lead_id:function(){return $("#lead-modal").find('input[name="leadid"]').val()}}};typeof app.lang[r+"_exists"]!="undefined"&&(t[r]={remote:app.lang[r+"_exists"]})});appValidateForm($("#lead_form"),n,lead_profile_form_handler,t)}function validate_lead_convert_to_client_form(){var n={firstname:"required",lastname:"required",password:{required:{depends:function(){var n=$('input[name="send_set_password_email"]');if(n.prop("checked")===!1)return!0}}},email:{required:!0,email:!0,remote:{url:admin_url+"misc/contact_email_exists",type:"post",data:{email:function(){return $('#lead_to_client_form input[name="email"]').val()},userid:""}}}};app.options.company_is_required==1&&(n.company="required");appValidateForm($("#lead_to_client_form"),n)}function lead_profile_form_handler(n){n=$(n);var t=n.serialize(),i=$("#lead-modal").find('input[name="leadid"]').val();return $(".lead-save-btn").addClass("disabled"),$.post(n.attr("action"),t).done(function(n){n=JSON.parse(n);n.message!==""&&alert_float("success",n.message);n.proposal_warning&&n.proposal_warning!=!1?($("body").find("#lead_proposal_warning").removeClass("hide"),$("body").find("#lead-modal").animate({scrollTop:0},800)):_lead_init_data(n,n.id);$.fn.DataTable.isDataTable(".table-leads")&&table_leads.DataTable().ajax.reload(null,!1)}).fail(function(n){return alert_float("danger",n.responseText),!1}),!1}function update_all_proposal_emails_linked_to_lead(n){$.post(admin_url+"leads/update_all_proposal_emails_linked_to_lead/"+n,{update:!0}).done(function(t){t=JSON.parse(t);t.success&&alert_float("success",t.message);init_lead_modal_data(n)})}function _lead_init_data(n,t){var u=window.location.hash,i=$("#lead-modal"),f,r;$("#lead_reminder_modal").html(n.leadView.reminder_data);i.find(".data").html(n.leadView.data);i.modal({show:!0,backdrop:"static"});init_tags_inputs();init_selectpicker();init_form_reminder();init_datepicker();init_color_pickers();validate_lead_form();f=["#tab_lead_profile","#attachments","#lead_notes","#lead_activity","#gdpr",];f.indexOf(u)>-1&&(window.location.hash=u);initDataTableInline($("#consentHistoryTable"));$("#lead-modal").find(".gpicker").googleDrivePicker({onPick:function(n){leadExternalFileUpload(n,"gdrive",t)}});t!==""&&typeof t!="undefined"&&(typeof Dropbox!="undefined"&&document.getElementById("dropbox-chooser-lead").appendChild(Dropbox.createChooseButton({success:function(n){leadExternalFileUpload(n,"dropbox",t)},linkType:"preview",extensions:app.options.allowed_files.split(",")})),typeof leadAttachmentsDropzone!="undefined"&&leadAttachmentsDropzone.destroy(),leadAttachmentsDropzone=new Dropzone("#lead-attachment-upload",appCreateDropzoneOptions({sending:function(n,i,r){r.append("id",t);this.getQueuedFiles().length===0&&r.append("last_file",!0)},success:function(n,t){t=JSON.parse(t);this.getUploadingFiles().length===0&&this.getQueuedFiles().length===0&&_lead_init_data(t,t.id)}})),i.find('.nav-tabs a[href="'+window.location.hash+'"]').tab("show"),r=i.find("#lead_activity .feed-item:last-child .text").html(),typeof r!="undefined"?i.find("#lead-latest-activity").html(r):i.find(".lead-latest-activity > .lead-info-heading").addClass("hide"),$("[lead-is-junk-or-lost]").length>0&&$(".form-group-select-input-status").find(".req").remove())}function init_lead_modal_data(n,t,i){var r=(typeof t!="undefined"?t:"leads/lead/")+(typeof n!="undefined"?n:""),u;i===!0&&(u="?",r.indexOf("?")>-1&&(u+="&"),r+=u+"edit=true");requestGetJSON(r).done(function(t){_lead_init_data(t,n)}).fail(function(n){alert_float("danger",n.responseText)})}function print_lead_information(){var t=$("#leadViewWrapper").clone(),i=t.find(".lead-name").text().trim(),n;t.find("p").css("font-size","100%").css("font","inherit").css("vertical-align","baseline").css("margin","0px");t.find("h4").css("font-size","100%");t.find(".lead-field-heading").css("color","#777").css("margin-bottom","3px");t.find(".lead-field-heading + p").css("margin-bottom","15px");n=_create_print_window(i);n.document.write("<html><head><title>"+app.lang.lead+"<\/title>");_add_print_window_default_styles(n);n.document.write("<style>");n.document.write(".lead-information-col { float: left; width: 33.33333333%;}");n.document.write("<\/style>");n.document.write("<\/head><body>");n.document.write("<h1>"+i+"<\/h1>");n.document.write('<div id="#leadViewWrapper">'+t.html()+"<\/div>");n.document.write("<\/body><\/html>");n.document.close();n.focus();n.print();n.close()}function print_expense_information(){var t=$("#tab_expense").clone(),i=$("#expenseHeadings"),r=i.find("#expenseCategory").text().trim()+"<h4>"+i.find("#expenseName").text().trim()+"<\/h4>",n;t.find("#expenseReceipt").remove();t.find("#amountWrapper").css("margin-bottom","15px");n=_create_print_window(r);n.document.write("<html><head><title>"+app.lang.expense+"<\/title>");_add_print_window_default_styles(n);n.document.write("<\/head><body>");n.document.write("<h1>"+r+"<\/h1>");n.document.write('<div id="#tab_expense">'+t.html()+"<\/div>");n.document.write("<\/body><\/html>");n.document.close();n.focus();n.print();n.close()}function print_ticket_message(n,t){var u=$("[data-"+t+'-id="'+n+'"]').html(),r=$("#ticket_subject").text().trim(),i=_create_print_window(r);i.document.write("<html><head><title>"+app.lang.ticket+"<\/title>");_add_print_window_default_styles(i);i.document.write("<\/head><body>");i.document.write("<h1>"+r+"<\/h1>");i.document.write(u);i.document.write("<\/body><\/html>");i.document.close();i.focus();i.print();i.close()}function leads_kanban_sort(n){kan_ban_sort(n,leads_kanban)}function leads_kanban_update(n,t){var i;if(t===n.item.parent()[0]){i={};i.status=$(n.item.parent()[0]).data("lead-status-id");i.leadid=$(n.item).data("lead-id");var r=[],f=$(n.item).parents(".leads-status").find("li"),u=1;$.each(f,function(){r.push([$(this).data("lead-id"),u]);u++});i.order=r;setTimeout(function(){$.post(admin_url+"leads/update_lead_status",i).done(function(){check_kanban_empty_col("[data-lead-id]")})},200)}}function init_leads_status_sortable(){$("#kan-ban").sortable({helper:"clone",item:".kan-ban-col",update:function(){var t=[],r=$(".kan-ban-col"),i=0,n;$.each(r,function(){t.push([$(this).data("col-status-id"),i]);i++});n={};n.order=t;$.post(admin_url+"leads/update_status_order",n)}})}function leads_kanban(){init_kanban("leads/kanban",leads_kanban_update,".leads-status",315,360,init_leads_status_sortable)}function delete_lead_attachment(n,t,i){confirm_delete()&&requestGetJSON("leads/delete_attachment/"+t+"/"+i).done(function(t){(t.success===!0||t.success=="true")&&$(n).parents(".lead-attachment-wrapper").remove()}).fail(function(n){alert_float("danger",n.responseText)})}function delete_lead_note(n,t,i){confirm_delete()&&requestGetJSON("leads/delete_note/"+t+"/"+i).done(function(t){(t.success===!0||t.success=="true")&&$(n).parents(".lead-note").remove()}).fail(function(n){alert_float("danger",n.responseText)})}function lead_mark_as_lost(n){requestGetJSON("leads/mark_as_lost/"+n).done(function(t){(t.success===!0||t.success=="true")&&(alert_float("success",t.message),$("body").find("tr#lead_"+n).remove(),$("body").find('#kan-ban li[data-lead-id="'+n+'"]').remove());_lead_init_data(t,t.id)}).fail(function(n){alert_float("danger",n.responseText)})}function lead_unmark_as_lost(n){requestGetJSON("leads/unmark_as_lost/"+n).done(function(n){(n.success===!0||n.success=="true")&&alert_float("success",n.message);_lead_init_data(n,n.id)}).fail(function(n){alert_float("danger",n.responseText)})}function lead_mark_as_junk(n){requestGetJSON("leads/mark_as_junk/"+n).done(function(t){(t.success===!0||t.success=="true")&&(alert_float("success",t.message),$("body").find("tr#lead_"+n).remove(),$("body").find('#kan-ban li[data-lead-id="'+n+'"]').remove());_lead_init_data(t,t.id)}).fail(function(n){alert_float("danger",n.responseText)})}function lead_mark_as(n,t){var i={};i.status=n;i.leadid=t;$.post(admin_url+"leads/update_lead_status",i).done(function(){table_leads.DataTable().ajax.reload(null,!1)})}function lead_unmark_as_junk(n){requestGetJSON("leads/unmark_as_junk/"+n).done(function(n){(n.success===!0||n.success=="true")&&alert_float("success",n.message);_lead_init_data(n,n.id)}).fail(function(n){alert_float("danger",n.responseText)})}function convert_lead_to_customer(n){var t=$("#lead-modal"),i="hidden.bs.modal.convert";t.on(i,function(){t.find(".data").html("");requestGet("leads/get_convert_data/"+n).done(function(n){$("#lead_convert_to_customer").html(n);$("#convert_lead_to_client_modal").modal({show:!0,backdrop:"static",keyboard:!1})}).fail(function(n){alert_float("danger",n.responseText)}).always(function(){t.off(i)})});t.modal("hide")}function leads_bulk_action(n){var u;if(confirm_delete()){var i=$("#mass_delete").prop("checked"),r=[],t={};if(i==!1||typeof i=="undefined"){if(t.lost=$("#leads_bulk_mark_lost").prop("checked"),t.status=$("#move_to_status_leads_bulk").val(),t.assigned=$("#assign_to_leads_bulk").val(),t.source=$("#move_to_source_leads_bulk").val(),t.last_contact=$("#leads_bulk_last_contact").val(),t.tags=$("#tags_bulk").tagit("assignedTags"),t.visibility=$('input[name="leads_bulk_visibility"]:checked').val(),t.assigned=typeof t.assigned=="undefined"?"":t.assigned,t.visibility=typeof t.visibility=="undefined"?"":t.visibility,t.status===""&&t.lost===!1&&t.assigned===""&&t.source===""&&t.last_contact===""&&t.tags.length==0&&t.visibility==="")return}else t.mass_delete=!0;u=table_leads.find("tbody tr");$.each(u,function(){var n=$($(this).find("td").eq(0)).find("input");n.prop("checked")===!0&&r.push(n.val())});t.ids=r;$(n).addClass("disabled");setTimeout(function(){$.post(admin_url+"leads/bulk_action",t).done(function(){window.location.reload()}).fail(function(n){$("#lead-modal").modal("hide");alert_float("danger",n.responseText)})},200)}}function init_proposal_editor(){var t,n;tinymce.remove("div.editable");t=[];$.each(proposalsTemplates,function(n,i){t.push({url:admin_url+"proposals/get_template?name="+i,title:i})});n={selector:"div.editable",inline:!0,theme:"inlite",relative_urls:!1,remove_script_host:!1,inline_styles:!0,verify_html:!1,cleanup:!1,apply_source_formatting:!1,valid_elements:"+*[*]",valid_children:"+body[style], +style[type]",file_browser_callback:elFinderBrowser,table_default_styles:{width:"100%"},fontsize_formats:"8pt 10pt 12pt 14pt 18pt 24pt 36pt",pagebreak_separator:'<p pagebreak="true"><\/p>',plugins:["advlist pagebreak autolink autoresize lists link image charmap hr","searchreplace visualblocks visualchars code","media nonbreaking table contextmenu","paste textcolor colorpicker",],autoresize_bottom_margin:50,insert_toolbar:"image media quicktable | bullist numlist | h2 h3 | hr",selection_toolbar:"save_button bold italic underline superscript | forecolor backcolor link | alignleft aligncenter alignright alignjustify | fontselect fontsizeselect h2 h3",contextmenu:"image media inserttable | cell row column deletetable | paste pastetext searchreplace | visualblocks pagebreak charmap | code",setup:function(n){n.addCommand("mceSave",function(){save_proposal_content(!0)});n.addShortcut("Meta+S","","mceSave");n.on("MouseLeave blur",function(){tinymce.activeEditor.isDirty()&&save_proposal_content()});n.on("MouseDown ContextMenu",function(){is_mobile()||$("#small-table").hasClass("hide")||small_table_full_view()});n.on("blur",function(){$.Shortcuts.start()});n.on("focus",function(){$.Shortcuts.stop()})}};is_mobile()&&(n.theme="modern",n.mobile={},n.mobile.theme="mobile",n.mobile.toolbar=_tinymce_mobile_toolbar(),n.inline=!1,window.addEventListener("beforeunload",function(){tinymce.activeEditor.isDirty()&&save_proposal_content()}));t.length>0&&(n.templates=t,n.plugins[3]="template "+n.plugins[3],n.contextmenu=n.contextmenu.replace("inserttable","inserttable template"));tinymce.init(n)}function add_proposal_comment(){var t=$("#comment").val(),n;t!=""&&(n={},n.content=t,n.proposalid=proposal_id,$("body").append('<div class="dt-loader"><\/div>'),$.post(admin_url+"proposals/add_proposal_comment",n).done(function(n){n=JSON.parse(n);$("body").find(".dt-loader").remove();n.success==!0&&($("#comment").val(""),get_proposal_comments())}))}function get_proposal_comments(){typeof proposal_id!="undefined"&&requestGet("proposals/get_proposal_comments/"+proposal_id).done(function(n){$("body").find("#proposal-comments").html(n)})}function remove_proposal_comment(n){confirm_delete()&&requestGetJSON("proposals/remove_comment/"+n).done(function(t){t.success==!0&&$('[data-commentid="'+n+'"]').remove()})}function edit_proposal_comment(n){var t=$("body").find('[data-proposal-comment-edit-textarea="'+n+'"] textarea').val();t!=""&&($.post(admin_url+"proposals/edit_comment/"+n,{content:t}).done(function(i){i=JSON.parse(i);i.success==!0&&(alert_float("success",i.message),$("body").find('[data-proposal-comment="'+n+'"]').html(nl2br(t)))}),toggle_proposal_comment_edit(n))}function toggle_proposal_comment_edit(n){$("body").find('[data-proposal-comment="'+n+'"]').toggleClass("hide");$("body").find('[data-proposal-comment-edit-textarea="'+n+'"]').toggleClass("hide")}function proposal_convert_template(n){var i=$(n).data("template"),t;if(i=="estimate")t="estimate";else if(i=="invoice")t="invoice";else return!1;requestGet("proposals/get_"+t+"_convert_data/"+proposal_id).done(function(n){$(".proposal-pipeline-modal").is(":visible")&&$(".proposal-pipeline-modal").modal("hide");$("#convert_helper").html(n);$("#convert_to_"+t).modal({show:!0,backdrop:"static"});reorder_items()})}function save_proposal_content(n){var i=tinyMCE.activeEditor,t={};t.proposal_id=proposal_id;t.content=i.getContent();$.post(admin_url+"proposals/save_proposal_data",t).done(function(t){t=JSON.parse(t);typeof n!="undefined"&&alert_float("success",t.message);i.save()}).fail(function(n){var t=JSON.parse(n.responseText);alert_float("danger",t.message)})}function sync_proposals_data(n,t){var i={},r=$("#sync_data_proposal_data");i.country=r.find('select[name="country"]').val();i.zip=r.find('input[name="zip"]').val();i.state=r.find('input[name="state"]').val();i.city=r.find('input[name="city"]').val();i.address=r.find('textarea[name="address"]').val();i.phone=r.find('input[name="phone"]').val();i.rel_id=n;i.rel_type=t;$.post(admin_url+"proposals/sync_data",i).done(function(n){n=JSON.parse(n);alert_float("success",n.message);r.modal("hide")})}function init_table_announcements(n){if(typeof n=="undefined"&&$("body").hasClass("dashboard"))return!1;initDataTable(".table-announcements",admin_url+"announcements",undefined,undefined,"undefined",[1,"desc"])}function init_table_tickets(n){var i,r,u,e;if(typeof n=="undefined"&&($("body").hasClass("dashboard")||$("body").hasClass("single-ticket")))return!1;if($("body").find(".tickets-table").length!==0){var t={},o=$("._hidden_inputs._filters.tickets_filters input"),f=$("table.tickets-table thead .ticket_created_column").index();if($.each(o,function(){t[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),t.project_id='[name="project_id"]',i=[0],r=admin_url+"tickets",$("body").hasClass("tickets-page")&&(r+="?bulk_actions=true"),_table_api=initDataTable(".tickets-table",r,i,i,t,[f,"desc"]),_table_api&&$("body").hasClass("dashboard")){u=[4,f,5,6];for(e in u)_table_api.column(u[e]).visible(!1,!1);_table_api.columns.adjust()}}}function init_table_staff_projects(n){if(typeof n=="undefined"&&$("body").hasClass("dashboard"))return!1;if($("body").find(".table-staff-projects").length!==0){var t={},i=$("._hidden_inputs._filters.staff_projects_filter input");$.each(i,function(){t[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'});initDataTable(".table-staff-projects",admin_url+"projects/staff_projects","undefined","undefined",t,[2,"asc"])}}function do_task_checklist_items_height(n){typeof n=="undefined"&&(n=$("body").find("textarea[name='checklist-description']"));$.each(n,function(){var n=$(this).val();$(this).outerHeight()<this.scrollHeight+parseFloat($(this).css("borderTopWidth"))+parseFloat($(this).css("borderBottomWidth"))&&($(this).height(0).height(this.scrollHeight),$(this).parents(".checklist").height(this.scrollHeight));n===""&&($(this).removeAttr("style"),$(this).parents(".checklist").removeAttr("style"))})}function recalculate_checklist_items_progress(){var r=$('input[name="checklist-box"]:checked').length,t=$('input[name="checklist-box"]').length,i=0,n=$(".task-progress-bar");if(t==0?($("body").find(".chk-heading").remove(),$("#task-no-checklist-items").removeClass("hide")):$("#task-no-checklist-items").addClass("hide"),t>2)n.parents(".progress").removeClass("hide"),i=r*100/t;else return n.parents(".progress").addClass("hide"),!1;n.css("width",i.toFixed(2)+"%");n.text(i.toFixed(2)+"%")}function remove_checklist_item_template(n){requestGetJSON("tasks/remove_checklist_item_template/"+n).done(function(t){if(t.success===!0||t.success=="true"){var i=$("body").find("select.checklist-items-template-select"),r=i.find('option[value="'+n+'"]').html().trim(),u=$("#task-modal .checklist");$.each(u,function(n,t){var i=$(t);i.find('textarea[name="checklist-description"]').val().trim()==r&&i.find(".save-checklist-template").removeClass("hide")});i.find('option[value="'+n+'"]').remove();i.selectpicker("refresh");i.find("option").length===1&&(i.selectpicker("destroy"),$(".checklist-templates-wrapper").addClass("hide"))}})}function save_checklist_item_template(n,t){var i=$('.checklist[data-checklist-id="'+n+'"] textarea').val();$.post(admin_url+"tasks/save_checklist_item_template",{description:i}).done(function(n){n=JSON.parse(n);$(t).addClass("hide");var r=$(".checklist-templates-wrapper");r.find('select option[value=""]').after('<option value="'+n.id+'">'+i.trim()+"<\/option>");r.removeClass("hide");r.find("select").selectpicker("refresh")})}function update_checklist_order(){var i=[],r=$("body").find(".checklist"),n,t;r.length!==0&&(n=1,$.each(r,function(){i.push([$(this).data("checklist-id"),n]);n++}),t={},t.order=i,$.post(admin_url+"tasks/update_checklist_order",t))}function add_task_checklist_item(n,t,i){i&&$(i).addClass("disabled");t=typeof t=="undefined"?"":t;$.post(admin_url+"tasks/add_checklist_item",{taskid:n,description:t}).done(function(){init_tasks_checklist_items(!0,n)}).always(function(){i&&$(i).removeClass("disabled")})}function update_task_checklist_item(n){var t=$.Deferred();return setTimeout(function(){var i=n.val(),r;i=i.trim();r=n.parents(".checklist").data("checklist-id");$.post(admin_url+"tasks/update_checklist_item",{description:i,listid:r}).done(function(u){t.resolve();u=JSON.parse(u);u.can_be_template===!0&&n.parents(".checklist").find(".save-checklist-template").removeClass("hide");i===""&&$("#checklist-items").find('.checklist[data-checklist-id="'+r+'"]').remove()})},300),t.promise()}function delete_checklist_item(n,t){requestGetJSON("tasks/delete_checklist_item/"+n).done(function(n){(n.success===!0||n.success=="true")&&($(t).parents(".checklist").remove(),recalculate_checklist_items_progress())})}function init_tasks_checklist_items(n,t){$.post(admin_url+"tasks/init_checklist_items",{taskid:t}).done(function(t){if($("#checklist-items").html(t),typeof n!="undefined"){var i=$("#checklist-items").find(".checklist textarea").eq(0);i.val()===""&&i.focus()}recalculate_checklist_items_progress();update_checklist_order()})}function _task_attachments_more_and_less_checks(){var t=$("body").find(".task_attachments_wrapper"),i=t.find(".task-attachment-col"),n=$("body").find("#show-more-less-task-attachments-col .task-attachments-more");i.length===0?t.remove():i.length==2&&n.hasClass("hide")?$("body").find("#show-more-less-task-attachments-col").remove():$(".task_attachments_wrapper .task-attachment-col:visible").length!==0||n.hasClass("hide")||n.click();$.each($("#task-modal .comment-content"),function(){$(this).find(".task-attachment-col").length===0&&$(this).find(".download-all").remove()})}function remove_task_attachment(n,t){confirm_delete()&&requestGetJSON("tasks/remove_task_attachment/"+t).done(function(n){(n.success===!0||n.success=="true")&&$('[data-task-attachment-id="'+t+'"]').remove();_task_attachments_more_and_less_checks();n.comment_removed&&$("#comment_"+n.comment_removed).remove()})}function add_task_comment(n){var t={};if(taskCommentAttachmentDropzone.files.length>0){taskCommentAttachmentDropzone.processQueue(n);return}tinymce.activeEditor?t.content=tinyMCE.activeEditor.getContent():(t.content=$("#task_comment").val(),t.no_editor=!0);t.taskid=n;$.post(admin_url+"tasks/add_task_comment",t).done(function(n){n=JSON.parse(n);_task_append_html(n.taskHtml);tinymce.remove("#task_comment")})}function remove_task_comment(n){confirm_delete()&&requestGetJSON("tasks/remove_comment/"+n).done(function(t){(t.success===!0||t.success=="true")&&($('[data-commentid="'+n+'"]').remove(),$('[data-comment-attachment="'+n+'"]').remove(),_task_attachments_more_and_less_checks())})}function remove_assignee(n,t){confirm_delete()&&requestGetJSON("tasks/remove_assignee/"+n+"/"+t).done(function(n){(n.success===!0||n.success=="true")&&(alert_float("success",n.message),_task_append_html(n.taskHtml))})}function remove_follower(n,t){confirm_delete()&&requestGetJSON("tasks/remove_follower/"+n+"/"+t).done(function(n){(n.success===!0||n.success=="true")&&(alert_float("success",n.message),_task_append_html(n.taskHtml))})}function mark_complete(n){task_mark_as(5,n)}function unmark_complete(n){task_mark_as(4,n,"tasks/unmark_complete/"+n)}function task_mark_as(n,t,i){i=typeof i=="undefined"?"tasks/mark_as/"+n+"/"+t:i;var r=$("#task-modal").is(":visible");i+="?single_task="+r;$("body").append('<div class="dt-loader"><\/div>');requestGetJSON(i).done(function(i){$("body").find(".dt-loader").remove();(i.success===!0||i.success=="true")&&(reload_tasks_tables(),r&&_task_append_html(i.taskHtml),n==5&&typeof _maybe_remove_task_from_project_milestone=="function"&&_maybe_remove_task_from_project_milestone(t),$(".tasks-kanban").length===0&&alert_float("success",i.message))})}function task_change_priority(n,t){url="tasks/change_priority/"+n+"/"+t;var i=$("#task-modal").is(":visible");url+="?single_task="+i;requestGetJSON(url).done(function(n){(n.success===!0||n.success=="true")&&(reload_tasks_tables(),i&&_task_append_html(n.taskHtml))})}function task_change_milestone(n,t){url="tasks/change_milestone/"+n+"/"+t;var i=$("#task-modal").is(":visible");url+="?single_task="+i;requestGetJSON(url).done(function(n){(n.success===!0||n.success=="true")&&(reload_tasks_tables(),i&&_task_append_html(n.taskHtml))})}function delete_user_unfinished_timesheet(n){confirm_delete()&&requestGetJSON("tasks/delete_user_unfinished_timesheet/"+n).done(function(n){_init_timers_top_html(JSON.parse(n.timers));reload_tasks_tables()})}function reload_tasks_tables(){$.each([".table-tasks",".table-rel-tasks",".table-rel-tasks-leads",".table-timesheets",".table-timesheets-report",],function(n,t){$.fn.DataTable.isDataTable(t)&&$(t).DataTable().ajax.reload(null,!1)})}function make_task_public(n){requestGetJSON("tasks/make_public/"+n).done(function(n){(n.success===!0||n.success=="true")&&(reload_tasks_tables(),_task_append_html(n.taskHtml))})}function new_task(n){var t,i,r;n=typeof n!="undefined"?n:admin_url+"tasks/task";t=$("#lead-modal");t.is(":visible")&&(n+="&opened_from_lead_id="+t.find('input[name="leadid"]').val(),n.indexOf("?")===-1&&(n=n.replace("&","?")),t.modal("hide"));i=$("#task-modal");i.is(":visible")&&i.modal("hide");r=$("#_task_modal");r.is(":visible")&&r.modal("hide");requestGet(n).done(function(n){$("#_task").html(n);$("body").find("#_task_modal").modal({show:!0,backdrop:"static"})}).fail(function(n){alert_float("danger",n.responseText)})}function showHideTagsPlaceholder(n){var t=n.data("ui-tagit").tagInput,i=n.data("ui-tagit").options.placeholderText;n.tagit("assignedTags").length>0?t.removeAttr("placeholder"):t.attr("placeholder",i)}function new_task_from_relation(n,t,i){typeof t=="undefined"&&typeof i=="undefined"&&(i=$(n).data("new-rel-id"),t=$(n).data("new-rel-type"));var r=admin_url+"tasks/task?rel_id="+i+"&rel_type="+t;new_task(r)}function edit_task(n){requestGet("tasks/task/"+n).done(function(n){$("#_task").html(n);$("#task-modal").modal("hide");$("body").find("#_task_modal").modal({show:!0,backdrop:"static"})})}function task_form_handler(n){tinymce.triggerSave();$("#_task_modal").find('input[name="startdate"]').prop("disabled",!1);$("#_task_modal").find('button[type="submit"]').prop("disabled",!0);$("#_task_modal input[type=file]").each(function(){$(this).val()===""&&$(this).prop("disabled",!0)});var t=n.action,i=new FormData($(n)[0]);return $.ajax({type:$(n).attr("method"),data:i,mimeType:$(n).attr("enctype"),contentType:!1,cache:!1,processData:!1,url:t}).done(function(n){var i,t,r,u;n=JSON.parse(n);(n.success===!0||n.success=="true")&&alert_float("success",n.message);$("body").hasClass("project")?(i=window.location.href,t=[],i=i.split("?"),r=get_url_param("group"),u=get_url_param("exclude_completed"),r&&(t.group=r),u&&(t.exclude_completed=u),t.taskid=n.id,window.location.href=buildUrl(i[0],t)):($("#_task_modal").attr("data-task-created",!0),$("#_task_modal").modal("hide"),init_task_modal(n.id),reload_tasks_tables(),$("body").hasClass("kan-ban-body")&&$("body").hasClass("tasks")&&tasks_kanban())}).fail(function(n){alert_float("danger",JSON.parse(n.responseText))}),!1}function system_popup(n){n.content=typeof n.content=="undefined"?"":n.content;var i=$("<div/>",{id:"system-popup","class":"system-popup"}).appendTo("body"),t="";t+='<div class="popup-wrapper fadeIn animated">';t+='<h2 class="popup-message">';t+=n.message;t+="<\/h2>";t+='<div class="popup-content">';t+=n.content;t+='<button type="button" class="system-popup-close"> <\/button>';t+="<\/div>";t+="<\/div>";i.html(t).removeClass("hide");$("body").addClass("system-popup");i.find(".system-popup-close").on("click",function(){var n=this;requestGet("misc/clear_system_popup").done(function(){setTimeout(function(){$("body").removeClass("system-popup");i.fadeOut(400,function(){i.remove()});$(n).off("click")},50)})});return i}function timer_action(n,t,i,r){var e,u,h,f,o,s;if(i=typeof i=="undefined"?"":i,e=$("#timer-select-task"),t!==""||!e.is(":visible")){if(i!==""&&t=="0")return u={},u.content="",u.content+='<div class="row">',u.content+='<div class="form-group"><select id="timer_add_task_id" data-empty-title="'+app.lang.search_tasks+'" data-width="60%" class="ajax-search" data-live-search="true">',u.content+="<\/select><\/div>",u.content+='<div class="form-group">',u.content+='<textarea id="timesheet_note" placeholder="'+app.lang.note+'" style="margin:0 auto;width:60%;" rows="4" class="form-control"><\/textarea>',u.content+="<\/div>",u.content+="<button type='button' onclick='timer_action(this,document.getElementById(\"timer_add_task_id\").value,"+i+");return false;' class='btn btn-info'>"+app.lang.confirm+"<\/button>",u.message=app.lang.task_stop_timer,h=system_popup(u),h.attr("id","timer-select-task"),init_ajax_search("tasks","#timer_add_task_id",undefined,admin_url+"tasks/ajax_search_assign_task_to_timer"),!1;$(n).addClass("disabled");f={};f.task_id=t;f.timer_id=i;f.note=$("body").find("#timesheet_note").val();f.note||(f.note="");o=$("#task-modal").is(":visible");s=admin_url+"tasks/timer_tracking?single_task="+o;r&&(s+="&admin_stop="+r);$.post(s,f).done(function(n){n=JSON.parse(n);$("body").hasClass("member")&&window.location.reload();o&&_task_append_html(n.taskHtml);e.is(":visible")&&e.find(".system-popup-close").click();_init_timers_top_html(JSON.parse(n.timers));$(".popover-top-timer-note").popover("hide");reload_tasks_tables()})}}function init_task_modal(n,t){var i="",r=$("#lead-modal"),u=$("#_task_modal");r.is(":visible")?(i+="?opened_from_lead_id="+r.find('input[name="leadid"]').val(),r.modal("hide")):u.attr("data-lead-id")!=undefined&&(i+="?opened_from_lead_id="+u.attr("data-lead-id"));requestGet("tasks/get_task_data/"+n+i).done(function(n){_task_append_html(n);typeof t!="undefined"&&setTimeout(function(){$('[data-task-comment-href-id="'+t+'"]').click()},1e3)}).fail(function(n){$("#task-modal").modal("hide");alert_float("danger",n.responseText)})}function _task_append_html(n){var t=$("#task-modal");t.find(".data").html(n);recalculate_checklist_items_progress();do_task_checklist_items_height();setTimeout(function(){t.modal("show");t.is(":visible")&&init_tags_inputs();init_form_reminder("task");fix_task_modal_left_col_height();is_mobile()&&init_new_task_comment(!0)},150)}function task_tracking_stats(n){requestGet("tasks/task_tracking_stats/"+n).done(function(n){$("<div/>",{id:"tracking-stats"}).appendTo("body").html(n);$("#task-tracking-stats-modal").modal("toggle")})}function init_timers(){requestGetJSON("tasks/get_staff_started_timers").done(function(n){_init_timers_top_html(n)})}function _init_timers_top_html(n){var i=$("#top-timers"),t=$("#top-timers").find(".icon-started-timers");n.total_timers>0?t.removeClass("hide").html(n.total_timers):t.addClass("hide");$("#started-timers-top").html(n.html)}function edit_task_comment(n){var i=$('[data-edit-comment="'+n+'"]'),t;i.next().addClass("hide");i.removeClass("hide");is_ios()||(tinymce.remove("#task_comment_"+n),t=_simple_editor_config(),t.auto_focus="task_comment_"+n,init_editor("#task_comment_"+n,t),tinymce.triggerSave())}function cancel_edit_comment(n){var t=$('[data-edit-comment="'+n+'"]');tinymce.remove('[data-edit-comment="'+n+'"] textarea');t.addClass("hide");t.next().removeClass("hide")}function save_edited_comment(n,t){tinymce.triggerSave();var i={};i.id=n;i.task_id=t;i.content=$('[data-edit-comment="'+n+'"]').find("textarea").val();is_ios()&&(i.no_editor=!0);$.post(admin_url+"tasks/edit_comment",i).done(function(t){t=JSON.parse(t);t.success===!0||t.success=="true"?(alert_float("success",t.message),_task_append_html(t.taskHtml)):cancel_edit_comment(n);tinymce.remove('[data-edit-comment="'+n+'"] textarea')})}function fix_task_modal_left_col_height(){is_mobile()||$("body").find(".task-single-col-left").css("min-height",$("body").find(".task-single-col-right").outerHeight(!0)+"px")}function tasks_kanban_update(n,t){var r;if(t===n.item.parent()[0]){var u=$(n.item.parent()[0]).data("task-status-id"),f=$(n.item.parent()[0]).find("[data-task-id]"),i={};i.order=[];r=0;$.each(f,function(){i.order.push([$(this).data("task-id"),r]);r++});task_mark_as(u,$(n.item).data("task-id"));check_kanban_empty_col("[data-task-id]");setTimeout(function(){$.post(admin_url+"tasks/update_order",i)},200)}}function tasks_kanban(){init_kanban("tasks/kanban",tasks_kanban_update,".tasks-status",265,360)}function edit_task_inline_description(n,t){if(tinyMCE.remove("#task_view_description"),$(n).hasClass("editor-initiated")){$(n).removeClass("editor-initiated");return}$(n).addClass("editor-initiated");$.Shortcuts.stop();tinymce.init({selector:"#task_view_description",theme:"inlite",skin:"perfex",auto_focus:"task_view_description",plugins:"table link paste contextmenu textpattern",insert_toolbar:"quicktable",selection_toolbar:"bold italic | quicklink h2 h3 blockquote",inline:!0,table_default_styles:{width:"100%"},setup:function(n){n.on("blur",function(){n.isDirty()&&$.post(admin_url+"tasks/update_task_description/"+t,{description:n.getContent()});setTimeout(function(){n.remove();$.Shortcuts.start()},500)})}})}function tasks_bulk_action(n){var i,r,u,o;if(confirm_delete()){var f=[],t={},e=$("#mass_delete").prop("checked");if(e==!1||typeof e=="undefined"){if(t.status=$("#move_to_status_tasks_bulk_action").val(),i=$("#task_bulk_assignees"),t.assignees=i.length?i.selectpicker("val"):"",r=$("#tags_bulk"),t.tags=r.length?r.tagit("assignedTags"):"",u=$("#task_bulk_milestone"),t.milestone=u.length?u.selectpicker("val"):"",t.priority=$("#task_bulk_priority").val(),t.priority=typeof t.priority=="undefined"?"":t.priority,t.status===""&&t.priority===""&&t.tags===""&&t.assignees===""&&t.milestone==="")return}else t.mass_delete=!0;o=$($("#tasks_bulk_actions").attr("data-table")).find("tbody tr");$.each(o,function(){var n=$($(this).find("td").eq(0)).find("input");n.prop("checked")===!0&&f.push(n.val())});t.ids=f;$(n).addClass("disabled");setTimeout(function(){$.post(admin_url+"tasks/bulk_action",t).done(function(){window.location.reload()})},200)}}function load_small_table_item(n,t,i,r,u){var f=$('input[name="'+i+'"]').val();(f===""||window.location.hash?window.location.hash&&!n&&(n=window.location.hash.substring(1)):(n=f,$('input[name="'+i+'"]').val("")),typeof n!="undefined"&&n!=="")&&(destroy_dynamic_scripts_in_element($(t)),$("body").hasClass("small-table")||toggle_small_view(u,t),$('input[name="'+i+'"]').val(n),do_hash_helper(n),$(t).load(admin_url+r+"/"+n),is_mobile()&&$("html, body").animate({scrollTop:$(t).offset().top+150},600))}function init_invoice(n){load_small_table_item(n,"#invoice","invoiceid","invoices/get_invoice_data_ajax",".table-invoices")}function init_credit_note(n){load_small_table_item(n,"#credit_note","credit_note_id","credit_notes/get_credit_note_data_ajax",".table-credit-notes")}function init_estimate(n){load_small_table_item(n,"#estimate","estimateid","estimates/get_estimate_data_ajax",".table-estimates")}function init_proposal(n){load_small_table_item(n,"#proposal","proposal_id","proposals/get_proposal_data_ajax",".table-proposals")}function init_expense(n){load_small_table_item(n,"#expense","expenseid","expenses/get_expense_data_ajax",".table-expenses")}function clear_billing_and_shipping_details(){for(var n in billingAndShippingFields)billingAndShippingFields[n].indexOf("country")>-1?$('select[name="'+billingAndShippingFields[n]+'"]').selectpicker("val",""):($('input[name="'+billingAndShippingFields[n]+'"]').val(""),$('textarea[name="'+billingAndShippingFields[n]+'"]').val("")),billingAndShippingFields[n]=="billing_country"&&($('input[name="include_shipping"]').prop("checked",!1),$('input[name="include_shipping"]').change());init_billing_and_shipping_details()}function init_billing_and_shipping_details(){var n,i=$('input[name="include_shipping"]').prop("checked");for(var t in billingAndShippingFields)n="",billingAndShippingFields[t].indexOf("country")>-1?n=$("#"+billingAndShippingFields[t]+" option:selected").data("subtext"):billingAndShippingFields[t].indexOf("shipping_street")>-1||billingAndShippingFields[t].indexOf("billing_street")>-1?$('textarea[name="'+billingAndShippingFields[t]+'"]').length&&(n=$('textarea[name="'+billingAndShippingFields[t]+'"]').val().replace(/(?:\r\n|\r|\n)/g,"<br />")):n=$('input[name="'+billingAndShippingFields[t]+'"]').val(),billingAndShippingFields[t].indexOf("shipping")>-1&&(i||(n="")),typeof n=="undefined"&&(n=""),n=n!==""?n:"--",$("."+billingAndShippingFields[t]).html(n);$("#billing_and_shipping_details").modal("hide")}function record_payment(n){typeof n!="undefined"&&n!==""&&$("#invoice").load(admin_url+"invoices/record_invoice_payment_ajax/"+n)}function schedule_invoice_send(n){$("#invoice").load(admin_url+"email_schedule_invoice/create/"+n)}function edit_invoice_scheduled_email(n){$("#invoice").load(admin_url+"email_schedule_invoice/edit/"+n)}function add_item_to_preview(n){requestGetJSON("invoice_items/get_item_by_id/"+n).done(function(n){var t,i;clear_item_preview_values();$('.main textarea[name="description"]').val(n.description);$('.main textarea[name="long_description"]').val(n.long_description.replace(/(<|&lt;)br\s*\/*(>|&gt;)/g," "));_set_item_preview_custom_fields_array(n.custom_fields);$('.main input[name="quantity"]').val(1);t=[];n.taxname&&n.taxrate&&t.push(n.taxname+"|"+n.taxrate);n.taxname_2&&n.taxrate_2&&t.push(n.taxname_2+"|"+n.taxrate_2);$(".main select.tax").selectpicker("val",t);$('.main input[name="unit"]').val(n.unit);var u=$("body").find('.accounting-template select[name="currency"]'),e=u.attr("data-base"),f=u.find("option:selected").val(),r=$('.main input[name="rate"]');e==f?r.val(n.rate):(i=n["rate_currency_"+f],i&&parseFloat(i)!==0?r.val(i):r.val(n.rate));$(document).trigger({type:"item-added-to-preview",item:n,item_type:"item"})})}function _set_item_preview_custom_fields_array(n){for(var t,u,i,f=["input","number","date_picker","date_picker_time","colorpicker",],r=0;r<n.length;r++)t=n[r],$.inArray(t.type,f)>-1?(u=$('tr.main td[data-id="'+t.id+'"] input'),u.val(t.value).trigger("change")):t.type=="textarea"?$('tr.main td[data-id="'+t.id+'"] textarea').val(t.value):t.type=="select"||t.type=="multiselect"?empty(t.value)||(i=t.value.split(","),i=i.map(function(n){return n.trim()}),$('tr.main td[data-id="'+t.id+'"] select').selectpicker("val",i)):t.type=="checkbox"&&(empty(t.value)||(i=t.value.split(","),i=i.map(function(n){return n.trim()}),$.each(i,function(n,i){$('tr.main td[data-id="'+t.id+'"] input[type="checkbox"][value="'+i+'"]').prop("checked",!0)})))}function add_task_to_preview_as_item(n){requestGetJSON("tasks/get_billable_task_data/"+n).done(function(t){t.taxname=$("select.main-tax").selectpicker("val");var i=$(".main");i.find('textarea[name="description"]').val(t.name);i.find('textarea[name="long_description"]').val(t.description);i.find('input[name="quantity"]').val(t.total_hours);i.find('input[name="rate"]').val(t.hourly_rate);i.find('input[name="unit"]').val("");$('input[name="task_id"]').val(n);$(document).trigger({type:"item-added-to-preview",item:t,item_type:"task"})})}function clear_item_preview_values(){var t=$("table.items tbody").find("tr:last-child").find("select").selectpicker("val"),n=$(".main");n.find("textarea").val("");n.find('td.custom_field input[type="checkbox"]').prop("checked",!1);n.find("td.custom_field input:not(:checkbox):not(:hidden)").val("");n.find("td.custom_field select").selectpicker("val","");n.find('input[name="quantity"]').val(1);n.find("select.tax").selectpicker("val",t);n.find('input[name="rate"]').val("");n.find('input[name="unit"]').val("");$('input[name="task_id"]').val("");$('input[name="expense_id"]').val("")}function add_item_to_table(n,t,i,r){var u,f,e,o,s;if(n=typeof n=="undefined"||n=="undefined"?get_item_preview_values():n,n.description!==""||n.long_description!==""||n.rate!=="")return u="",f=$("body").find("tbody .item").length+1,u+='<tr class="sortable item" data-merge-invoice="'+i+'" data-bill-expense="'+r+'">',u+='<td class="dragger">',isNaN(n.qty)&&(n.qty=1),(n.rate===""||isNaN(n.rate))&&(n.rate=0),e=n.rate*n.qty,o="newitems["+f+"][taxname][]",$("body").append('<div class="dt-loader"><\/div>'),s=/<br[^>]*>/gi,get_taxes_dropdown_template(o,n.taxname).done(function(i){var c,r,o,h;return u+='<input type="hidden" class="order" name="newitems['+f+'][order]">',u+="<\/td>",u+='<td class="bold description"><textarea name="newitems['+f+'][description]" class="form-control" rows="5">'+n.description+"<\/textarea><\/td>",u+='<td><textarea name="newitems['+f+'][long_description]" class="form-control item_long_description" rows="5">'+n.long_description.replace(s,"\n")+"<\/textarea><\/td>",c=$("tr.main td.custom_field"),r=!1,c.length>0&&$.each(c,function(){var t=$(this).clone(),e="",i=$(this).find("[data-fieldid]"),s="newitems["+f+"][custom_fields][items]["+i.attr("data-fieldid")+"]",c,l,n,h,o,a;i.is(":checkbox")?(c=$(this).find('input[type="checkbox"]:checked'),l=t.find('input[type="checkbox"]'),$.each(l,function(){var n=Math.random().toString(20).slice(2);$(this).attr("id",n).attr("name",s).next("label").attr("for",n);$(this).attr("data-custom-field-required")=="1"&&(r=!0)}),$.each(c,function(n,i){t.find('input[value="'+$(i).val()+'"]').attr("checked",!0)}),e=t.html()):i.is("input")||i.is("textarea")?(i.is("input")?t.find("[data-fieldid]").attr("value",i.val()):t.find("[data-fieldid]").html(i.val()),t.find("[data-fieldid]").attr("name",s),t.find("[data-fieldid]").attr("data-custom-field-required")=="1"&&(r=!0),e=t.html()):i.is("select")&&($(this).attr("data-custom-field-required")=="1"&&(r=!0),n=$(this).find("select[data-fieldid]").selectpicker("val"),n=typeof(n!="array")?new Array(n):n,n=n[0].constructor===Array?n[0]:n,h=t.find("select"),o=$("<div/>"),h.attr("name",s),a=h.clone(),o.append(a),$.each(n,function(n,t){o.find('select option[value="'+t+'"]').attr("selected",!0)}),e=o.html());u+='<td class="custom_field">'+e+"<\/td>"}),u+='<td><input type="number" min="0" onblur="calculate_total();" onchange="calculate_total();" data-quantity name="newitems['+f+'][qty]" value="'+n.qty+'" class="form-control">',n.unit&&typeof n.unit!="undefined"||(n.unit=""),u+='<input type="text" placeholder="'+app.lang.unit+'" name="newitems['+f+'][unit]" class="form-control input-transparent text-right" value="'+n.unit+'">',u+="<\/td>",u+='<td class="rate"><input type="number" data-toggle="tooltip" title="'+app.lang.item_field_not_formatted+'" onblur="calculate_total();" onchange="calculate_total();" name="newitems['+f+'][rate]" value="'+n.rate+'" class="form-control"><\/td>',u+='<td class="taxrate">'+i+"<\/td>",u+='<td class="amount" align="right">'+format_money(e,!0)+"<\/td>",u+='<td><a href="#" class="btn btn-danger pull-left" onclick="delete_item(this,'+t+'); return false;"><i class="fa fa-trash"><\/i><\/a><\/td>',u+="<\/tr>",$("table.items tbody").append(u),$(document).trigger({type:"item-added-to-table",data:n,row:u}),setTimeout(function(){calculate_total()},15),o=$('input[name="task_id"]').val(),h=$('input[name="expense_id"]').val(),o!==""&&typeof o!="undefined"&&(billed_tasks=o.split(","),$.each(billed_tasks,function(n,t){$("#billed-tasks").append(hidden_input("billed_tasks["+f+"][]",t))})),h!==""&&typeof h!="undefined"&&(billed_expenses=h.split(","),$.each(billed_expenses,function(n,t){$("#billed-expenses").append(hidden_input("billed_expenses["+f+"][]",t))})),$("#item_select").hasClass("ajax-search")&&$("#item_select").selectpicker("val")!==""&&$("#item_select").prepend("<option><\/option>"),init_selectpicker(),init_datepicker(),init_color_pickers(),clear_item_preview_values(),reorder_items(),$("body").find("#items-warning").remove(),$("body").find(".dt-loader").remove(),$("#item_select").selectpicker("val",""),r&&$(".invoice-form").length?validate_invoice_form():r&&$(".estimate-form").length?validate_estimate_form():r&&$(".proposal-form").length?validate_proposal_form():r&&$(".credit-note-form").length&&validate_credit_note_form(),!0}),!1}function get_taxes_dropdown_template(n,t){jQuery.ajaxSetup({async:!1});var i=$.post(admin_url+"misc/get_taxes_dropdown_template/",{name:n,taxname:t});return jQuery.ajaxSetup({async:!0}),i}function deselect_ajax_search(n){var t=$("select#"+$(n).attr("data-id")),i;t.data("AjaxBootstrapSelect").list.cache={};i=t.parents(".bootstrap-select");t.html("").append('<option value=""><\/option>').selectpicker("val",t.attr("multiple")=="multiple"?[]:"");i.removeClass("ajax-remove-values-option").find(".ajax-clear-values").remove();setTimeout(function(){t.trigger("selected.cleared.ajax.bootstrap.select",n);t.trigger("change").data("AjaxBootstrapSelect").list.cache={}},50)}function init_ajax_project_search_by_customer_id(n){n=typeof n=="undefined"?"#project_id.ajax-search":n;init_ajax_search("project",n,{customer_id:function(){return $('select[name="clientid"]').val()}})}function init_ajax_projects_search(n){n=typeof n=="undefined"?"#project_id.ajax-search":n;init_ajax_search("project",n)}function init_items_sortable(n){var t=$("#wrapper").find(".items tbody");t.length!==0&&t.sortable({helper:fixHelperTableHelperSortable,handle:".dragger",placeholder:"ui-placeholder",itemPath:"> tbody",itemSelector:"tr.sortable",items:"tr.sortable",update:function(){typeof n=="undefined"?reorder_items():save_ei_items_order()},sort:function(n,t){var i=$(n.target),r;/html|body/i.test(i.offsetParent()[0].tagName)||(r=n.pageY-i.offsetParent().offset().top-t.helper.outerHeight(!0)/2,t.helper.css({top:r+"px"}))}})}function save_ei_items_order(){var t=$(".table.items-preview"),u=t.find("tbody tr"),n=1,i=t.attr("data-type"),r=[];if(!i)return!1;$.each(u,function(){r.push([$(this).data("item-id"),n]);$(this).find("td.item_no").html(n);n++});setTimeout(function(){$.post(admin_url+"misc/update_ei_items_order/"+i,{data:r})},200)}function reorder_items(){var t=$(".table.has-calculations tbody tr.item"),n=1;$.each(t,function(){$(this).find("input.order").val(n);n++})}function get_item_preview_values(){var n={};return n.description=$('.main textarea[name="description"]').val(),n.long_description=$('.main textarea[name="long_description"]').val(),n.qty=$('.main input[name="quantity"]').val(),n.taxname=$(".main select.tax").selectpicker("val"),n.rate=$('.main input[name="rate"]').val(),n.unit=$('.main input[name="unit"]').val(),n}function calculate_total(){var w;if($("body").hasClass("no-calculate-total"))return!1;var a,c,v,y,u,p,s={},f=0,n=0,l=1,r=0,b=$(".table.has-calculations tbody tr.item"),k=$("#discount_area"),h=$('input[name="adjustment"]').val(),t=$('input[name="discount_percent"]').val(),i=$('input[name="discount_total"]').val(),e=$(".discount-total-type.selected"),o=$('select[name="discount_type"]').val();$(".tax-area").remove();$.each(b,function(){l=$(this).find("[data-quantity]").val();l===""&&(l=1,$(this).find("[data-quantity]").val(1));u=accounting.toFixed($(this).find("td.rate input").val()*l,app.options.decimal_places);u=parseFloat(u);$(this).find("td.amount").html(format_money(u,!0));f+=u;y=$(this);v=$(this).find("select.tax").selectpicker("val");v&&$.each(v,function(n,t){c=y.find('select.tax [value="'+t+'"]').data("taxrate");a=u/100*c;s.hasOwnProperty(t)?s[t]=s[t]+=a:c!=0&&(p=t.split("|"),tax_row='<tr class="tax-area"><td>'+p[0]+"("+c+'%)<\/td><td id="tax_id_'+slugify(t)+'"><\/td><\/tr>',$(k).after(tax_row),s[t]=a)})});t!==""&&t!=0&&o=="before_tax"&&e.hasClass("discount-type-percent")?r=f*t/100:i!==""&&i!=0&&o=="before_tax"&&e.hasClass("discount-type-fixed")&&(r=i);$.each(s,function(r,u){if(t!==""&&t!=0&&o=="before_tax"&&e.hasClass("discount-type-percent"))total_tax_calculated=u*t/100,u=u-total_tax_calculated;else if(i!==""&&i!=0&&o=="before_tax"&&e.hasClass("discount-type-fixed")){var s=i/f*100;u=u-u*s/100}n+=u;u=format_money(u);$("#tax_id_"+slugify(r)).html(u)});n=n+f;t!==""&&t!=0&&o=="after_tax"&&e.hasClass("discount-type-percent")?r=n*t/100:i!==""&&i!=0&&o=="after_tax"&&e.hasClass("discount-type-fixed")&&(r=i);n=n-r;h=parseFloat(h);isNaN(h)||(n=n+h);w="-"+format_money(r);$('input[name="discount_total"]').val(accounting.toFixed(r,app.options.decimal_places));$(".discount-total").html(w);$(".adjustment").html(format_money(h));$(".subtotal").html(format_money(f)+hidden_input("subtotal",accounting.toFixed(f,app.options.decimal_places)));$(".total").html(format_money(n)+hidden_input("total",accounting.toFixed(n,app.options.decimal_places)));$(document).trigger("sales-total-calculated")}function exclude_tax_from_amount(n,t){return totalTax=accounting.toFixed(t*n/(100+n),app.options.decimal_places),accounting.toFixed(t-totalTax,app.options.decimal_places)}function delete_item(n,t){$(n).parents("tr").addClass("animated fadeOut",function(){setTimeout(function(){$(n).parents("tr").remove();calculate_total()},50)});$('input[name="isedit"]').length>0&&$("#removed-items").append(hidden_input("removed_items[]",t))}function format_money(n,t){return typeof t!="undefined"&&t?accounting.formatMoney(n,{symbol:""}):accounting.formatMoney(n)}function init_currency(n){var t=$("body").find(".accounting-template"),i;(t.length||n)&&(i=n?n:t.find('select[name="currency"]').val(),requestGetJSON("misc/get_currency/"+i).done(function(n){accounting.settings.currency.decimal=n.decimal_separator;accounting.settings.currency.thousand=n.thousand_separator;accounting.settings.currency.symbol=n.symbol;accounting.settings.currency.format=n.placement=="after"?"%v %s":"%s%v";calculate_total()}))}function delete_invoice_attachment(n){confirm_delete()&&requestGet("invoices/delete_attachment/"+n).done(function(t){t==1&&($("body").find('[data-attachment-id="'+n+'"]').remove(),init_invoice($("body").find('input[name="_attachment_sale_id"]').val()))}).fail(function(n){alert_float("danger",n.responseText)})}function delete_credit_note_attachment(n){confirm_delete()&&requestGet("credit_notes/delete_attachment/"+n).done(function(t){t==1&&($("body").find('[data-attachment-id="'+n+'"]').remove(),init_credit_note($("body").find('input[name="_attachment_sale_id"]').val()))}).fail(function(n){alert_float("danger",n.responseText)})}function delete_estimate_attachment(n){confirm_delete()&&requestGet("estimates/delete_attachment/"+n).done(function(t){if(t==1){$("body").find('[data-attachment-id="'+n+'"]').remove();var i=$("body").find('input[name="_attachment_sale_id"]').val();$("body").hasClass("estimates-pipeline")?estimate_pipeline_open(i):init_estimate(i)}}).fail(function(n){alert_float("danger",n.responseText)})}function delete_proposal_attachment(n){confirm_delete()&&requestGet("proposals/delete_attachment/"+n).done(function(t){if(t==1){var i=$("body").find('input[name="_attachment_sale_id"]').val();$("body").find('[data-attachment-id="'+n+'"]').remove();$("body").hasClass("proposals-pipeline")?proposal_pipeline_open(i):init_proposal(i)}}).fail(function(n){alert_float("danger",n.responseText)})}function init_invoices_total(n){var i,t,f,r;if($("#invoices_total").length!==0&&(i=$(".invoices-total-inline"),t=$(".invoices-total"),!$("body").hasClass("invoices-total-manual")||typeof n!="undefined"||t.hasClass("initialized"))){if(i.length>0&&t.hasClass("initialized")){i.removeClass("invoices-total-inline");return}t.addClass("initialized");f=$("body").find('select[name="invoices_total_years"]').selectpicker("val");r=[];$.each(f,function(n,t){t!==""&&r.push(t)});var s=$("body").find('select[name="total_currency"]').val(),u={currency:s,years:r,init_total:!0},e=$('input[name="project_id"]').val(),o=$('.customer_profile input[name="userid"]').val();typeof e!="undefined"?u.project_id=e:typeof o!="undefined"&&(u.customer_id=o);$.post(admin_url+"invoices/get_invoices_total",u).done(function(n){$("#invoices_total").html(n)})}}function init_estimates_total(n){var t;if($("#estimates_total").length!==0&&(t=$(".estimates-total"),!$("body").hasClass("estimates-total-manual")||typeof n!="undefined"||t.hasClass("initialized"))){t.addClass("initialized");var o=$("body").find('select[name="total_currency"]').val(),s=$("body").find('select[name="estimates_total_years"]').selectpicker("val"),i=[];$.each(s,function(n,t){t!==""&&i.push(t)});var r="",u="",f=$('.customer_profile input[name="userid"]').val(),e=$('input[name="project_id"]').val();typeof f!="undefined"?r=f:typeof e!="undefined"&&(u=e);$.post(admin_url+"estimates/get_estimates_total",{currency:o,init_total:!0,years:i,customer_id:r,project_id:u}).done(function(n){$("#estimates_total").html(n)})}}function init_expenses_total(){var n,r,t,u;if($("#expenses_total").length!==0){var f=$("body").find('select[name="expenses_total_currency"]').val(),e=$("body").find('select[name="expenses_total_years"]').selectpicker("val"),i=[];$.each(e,function(n,t){t!==""&&i.push(t)});n="";r=$('.customer_profile input[name="userid"]').val();typeof n!="undefined"&&(n=r);t="";u=$('input[name="project_id"]').val();typeof t!="undefined"&&(t=u);$.post(admin_url+"expenses/get_expenses_total",{currency:f,init_total:!0,years:i,customer_id:n,project_id:t}).done(function(n){$("#expenses_total").html(n)})}}function validate_invoice_form(n){n=typeof n=="undefined"?"#invoice-form":n;appValidateForm($(n),{clientid:{required:{depends:function(){var n=$("select#clientid").hasClass("customer-removed");return!n}}},date:"required",currency:"required",repeat_every_custom:{min:1},number:{required:!0}});$("body").find('input[name="number"]').rules("add",{remote:{url:admin_url+"invoices/validate_invoice_number",type:"post",data:{number:function(){return $('input[name="number"]').val()},isedit:function(){return $('input[name="number"]').data("isedit")},original_number:function(){return $('input[name="number"]').data("original-number")},date:function(){return $('input[name="date"]').val()}}},messages:{remote:app.lang.invoice_number_exists}})}function validate_credit_note_form(n){n=typeof n=="undefined"?"#credit-note-form":n;appValidateForm($(n),{clientid:{required:{depends:function(){var n=$("select#clientid").hasClass("customer-removed");return!n}}},date:"required",currency:"required",number:{required:!0}});$("body").find('input[name="number"]').rules("add",{remote:{url:admin_url+"credit_notes/validate_number",type:"post",data:{number:function(){return $('input[name="number"]').val()},isedit:function(){return $('input[name="number"]').data("isedit")},original_number:function(){return $('input[name="number"]').data("original-number")}}},messages:{remote:app.lang.credit_note_number_exists}})}function validate_estimate_form(n){n=typeof n=="undefined"?"#estimate-form":n;appValidateForm($(n),{clientid:{required:{depends:function(){var n=$("select#clientid").hasClass("customer-removed");return!n}}},date:"required",currency:"required",number:{required:!0}});$("body").find('input[name="number"]').rules("add",{remote:{url:admin_url+"estimates/validate_estimate_number",type:"post",data:{number:function(){return $('input[name="number"]').val()},isedit:function(){return $('input[name="number"]').data("isedit")},original_number:function(){return $('input[name="number"]').data("original-number")},date:function(){return $("body").find('.estimate input[name="date"]').val()}}},messages:{remote:app.lang.estimate_number_exists}})}function estimates_pipeline_sort(n){kan_ban_sort(n,estimate_pipeline)}function proposal_pipeline_sort(n){kan_ban_sort(n,proposals_pipeline)}function estimate_pipeline(){init_kanban("estimates/get_pipeline",estimates_pipeline_update,".pipeline-status",347,360)}function estimates_pipeline_update(n,t){var i;if(t===n.item.parent()[0]){i={};i.estimateid=$(n.item).data("estimate-id");i.status=$(n.item.parent()[0]).data("status-id");var r=[],f=$(n.item).parents(".pipeline-status").find("li"),u=1;$.each(f,function(){r.push([$(this).data("estimate-id"),u]);u++});i.order=r;check_kanban_empty_col("[data-estimate-id]");$.post(admin_url+"estimates/update_pipeline",i)}}function proposals_pipeline_update(n,t){var i,u,r;t===n.item.parent()[0]&&(i={},i.order=[],i.proposalid=$(n.item).data("proposal-id"),i.status=$(n.item.parent()[0]).data("status-id"),u=$(n.item).parents(".pipeline-status").find("li"),r=1,$.each(u,function(){i.order.push([$(this).data("proposal-id"),r]);r++}),check_kanban_empty_col("[data-proposal-id]"),$.post(admin_url+"proposals/update_pipeline",i))}function proposals_pipeline(){init_kanban("proposals/get_pipeline",proposals_pipeline_update,".pipeline-status",347,360)}function proposal_pipeline_open(n){n!==""&&requestGet("proposals/pipeline_open/"+n).done(function(n){var t=$(".proposal-pipeline-modal:visible").length>0;$("#proposal").html(n);t?$("#proposal").find(".modal.proposal-pipeline-modal").removeClass("fade").addClass("in").css("display","block"):$(".proposal-pipeline-modal").modal({show:!0,backdrop:"static",keyboard:!1})})}function estimate_pipeline_open(n){n!==""&&requestGet("estimates/pipeline_open/"+n).done(function(n){var t=$(".estimate-pipeline:visible").length>0;$("#estimate").html(n);t?$("#estimate").find(".modal.estimate-pipeline").removeClass("fade").addClass("in").css("display","block"):$(".estimate-pipeline").modal({show:!0,backdrop:"static",keyboard:!1})})}function delete_sales_note(n,t){confirm_delete()&&requestGetJSON("misc/delete_note/"+t).done(function(t){if(t.success===!0||t.success=="true"){$(n).parents(".sales-note-wrapper").remove();var r=$("#sales-notes-wrapper"),i=r.attr("data-total")-1,u=$(".notes-total");r.attr("data-total",i);i<=0?u.addClass("hide"):u.html('<span class="badge">'+i+"<\/span>")}})}function get_sales_notes(n,t){requestGet(t+"/get_notes/"+n).done(function(n){$("#sales_notes_area").html(n);var t=$("#sales-notes-wrapper").attr("data-total");t>0&&$(".notes-total").html('<span class="badge">'+t+"<\/span>").removeClass("hide")})}function insert_proposal_merge_field(n){tinymce.activeEditor.execCommand("mceInsertContent",!1,$(n).text())}function small_table_full_view(){$("#small-table").toggleClass("hide");$(".small-table-right-col").toggleClass("col-md-12 col-md-7");$(window).trigger("resize")}function save_sales_number_settings(n){var t={};t.prefix=$("body").find('input[name="s_prefix"]').val();$.post($(n).data("url"),t).done(function(n){n=JSON.parse(n);n.success&&n.message&&(alert_float("success",n.message),$("#prefix").html(t.prefix))})}function do_prefix_year(n){var t=_split_formatted_date_by_separator(n);typeof t!="undefined"&&$.each(t,function(n,i){var r,u;i.length==4&&(r=$("#prefix_year"),r.hasClass("format-n-yy")?i=i.substr(-2):r.hasClass("format-mm-yyyy")&&(app.options.date_format=="d-m-Y"||app.options.date_format=="d/m/Y"||app.options.date_format=="Y-m-d"||app.options.date_format=="d.m.Y"?u=1:(app.options.date_format=="m-d-Y"||app.options.date_format=="m.d.Y"||app.options.date_format=="m/d/Y")&&(u=0),$("#prefix_month").html(t[u])),r.html(i))})}function unformat_date(n){var t=_split_formatted_date_by_separator(n),i=1,r=0,u=2;return app.options.date_format=="d-m-Y"||app.options.date_format=="d/m/Y"||app.options.date_format=="d.m.Y"?(u=0,i=1,r=2):(app.options.date_format=="m-d-Y"||app.options.date_format=="m.d.Y"||app.options.date_format=="m/d/Y")&&(u=1,i=0,r=2),t[r]+"-"+t[i]+"-"+t[u]}function _split_formatted_date_by_separator(n){var t;return n.indexOf(".")>-1?t=n.split("."):n.indexOf("-")>-1?t=n.split("-"):n.indexOf("/")>-1&&(t=n.split("/")),t}function init_tabs_scrollable(){isRTL!="true"?($(window).width()<=768&&$("body").find(".toggle_view").remove(),$(".horizontal-scrollable-tabs").horizontalTabs()):($(".arrow-left, .arrow-right").css("display","none"),$(".horizontal-scrollable-tabs").removeClass("horizontal-scrollable-tabs"),$(".nav-tabs-horizontal").removeClass("nav-tabs-horizontal"))}function view_contact_consent(n){requestGet("clients/consents/"+n).done(function(n){$("#consent_data").html(n);initDataTableInline($("#consentHistoryTable"));$("#consentModal").modal("show")})}function view_lead_consent(n){window.location.hash="gdpr";init_lead(n)}function set_notification_read_inline(n){requestGet("misc/set_notification_read_inline/"+n).done(function(){var t=$("body").find('.notification-wrapper[data-notification-id="'+n+'"]');t.find(".notification-box,.notification-box-all").removeClass("unread");t.find(".not-mark-as-read-inline").tooltip("destroy").remove()})}function mark_all_notifications_as_read_inline(){requestGet("misc/mark_all_notifications_as_read_inline/").done(function(){var n=$("body").find(".notification-wrapper");n.find(".notification-box,.notification-box-all").removeClass("unread");n.find(".not-mark-as-read-inline").tooltip("destroy").remove()})}function delete_sale_activity(n){confirm_delete()&&requestGet("misc/delete_sale_activity/"+n).done(function(){$("body").find('[data-sale-activity-id="'+n+'"]').remove()})}function view_event(n){typeof n!="undefined"&&$.post(admin_url+"utilities/view_event/"+n).done(function(n){$("#event").html(n);$("#viewEvent").modal("show");init_datepicker();init_selectpicker();validate_calendar_form()})}function delete_event(n){confirm_delete()&&requestGetJSON("utilities/delete_event/"+n).done(function(n){(n.success===!0||n.success=="true")&&window.location.reload()})}function validate_calendar_form(){appValidateForm($("body").find("._event form"),{title:"required",start:"required",reminder_before:"required"},calendar_form_handler);appValidateForm($("body").find("#viewEvent form"),{title:"required",start:"required",reminder_before:"required"},calendar_form_handler)}function calendar_form_handler(n){return $.post(n.action,$(n).serialize()).done(function(n){n=JSON.parse(n);(n.success===!0||n.success=="true")&&(alert_float("success",n.message),setTimeout(function(){var n=window.location.href;n=n.split("?");window.location.href=n[0]},500))}),!1}function fetch_notifications(){requestGetJSON("misc/notifications_check").done(function(n){var i=notifications_wrapper,r,t,u;i.html(n.html);r=i.find("ul.notifications").attr("data-total-unread");document.title=r>0?"("+r+") "+doc_initial_title:doc_initial_title;t=n.notificationsIds;app.browser=="firefox"&&t.length>1&&(u=t[0],t=[],t.push(u));setTimeout(function(){t.length>0&&$.each(t,function(n,t){var r='li[data-notification-id="'+t+'"]',u=i.find(r);$.notify("",{title:app.lang.new_notification,body:u.find(".notification-title").text(),requireInteraction:!0,icon:u.find(".notification-image").attr("src"),tag:t,closeTime:app.options.dismiss_desktop_not_after!="0"?app.options.dismiss_desktop_not_after*1e3:null}).close(function(){requestGet("misc/set_desktop_notification_read/"+t).done(function(){var r=i.find(".icon-total-indicator"),n;i.find('li[data-notification-id="'+t+'"] .notification-box').removeClass("unread");n=r.text();n=n.trim();n=n-1;n>0?(document.title="("+n+") "+doc_initial_title,r.html(n)):(document.title=doc_initial_title,r.addClass("hide"))})}).click(function(n){parent.focus();window.focus();setTimeout(function(){i.find(r+" .notification-link").addClass("desktopClick").click();n.target.close()},70)})})},10)})}function init_new_task_comment(n){var t,i;tinymce.editors.task_comment&&tinymce.remove("#task_comment");typeof taskCommentAttachmentDropzone!="undefined"&&taskCommentAttachmentDropzone.destroy();$("#dropzoneTaskComment").removeClass("hide");$("#addTaskCommentBtn").removeClass("hide");taskCommentAttachmentDropzone=new Dropzone("#task-comment-form",appCreateDropzoneOptions({uploadMultiple:!0,clickable:"#dropzoneTaskComment",previewsContainer:".dropzone-task-comment-previews",autoProcessQueue:!1,addRemoveLinks:!0,parallelUploads:20,maxFiles:20,paramName:"file",sending:function(n,t,i){i.append("taskid",$("#addTaskCommentBtn").attr("data-comment-task-id"));tinyMCE.activeEditor?i.append("content",tinyMCE.activeEditor.getContent()):i.append("content",$("#task_comment").val())},success:function(n,t){t=JSON.parse(t);this.getUploadingFiles().length===0&&this.getQueuedFiles().length===0&&(_task_append_html(t.taskHtml),tinymce.remove("#task_comment"))}}));t=_simple_editor_config();(typeof n=="undefined"||n===!1)&&(t.auto_focus=!0);i=is_ios();i||init_editor("#task_comment",t)}function init_ajax_search(n,t,i,r){var u=$("body").find(t),f;u.length&&(f={ajax:{url:typeof r=="undefined"?admin_url+"misc/get_relation_data":r,data:function(){var t={};return t.type=n,t.rel_id="",t.q="{{{q}}}",typeof i!="undefined"&&jQuery.extend(t,i),t}},locale:{emptyTitle:app.lang.search_ajax_empty,statusInitialized:app.lang.search_ajax_initialized,statusSearching:app.lang.search_ajax_searching,statusNoResults:app.lang.not_results_found,searchPlaceholder:app.lang.search_ajax_placeholder,currentlySelected:app.lang.currently_selected},requestDelay:500,cache:!1,preprocessData:function(n){for(var i,r=[],u=n.length,t=0;t<u;t++)i={value:n[t].id,text:n[t].name},n[t].subtext&&(i.data={subtext:n[t].subtext}),r.push(i);return r},preserveSelectedPosition:"after",preserveSelected:!0},u.data("empty-title")&&(f.locale.emptyTitle=u.data("empty-title")),u.selectpicker().ajaxSelectPicker(f))}function merge_field_format_url(n){return n.indexOf("{")>-1&&n.indexOf("}")>-1?n="{"+n.split("{")[1]:n.indexOf("%7B")>-1&&n.indexOf("%7D")>-1&&(n="{"+n.replace("%7B","").replace("%7D","")+"}"),n}function salesGoogleDriveSave(n){salesExtenalFileUpload(n,"gdrive")}function leadExternalFileUpload(n,t,i){$.post(admin_url+"leads/add_external_attachment",{files:n,lead_id:i,external:t}).done(function(){init_lead_modal_data(i)})}function taskExternalFileUpload(n,t,i){$.post(admin_url+"tasks/add_external_attachment",{files:n,task_id:i,external:t}).done(function(){init_task_modal(i)})}function salesExtenalFileUpload(n,t){var i={};i.rel_id=$("body").find('input[name="_attachment_sale_id"]').val();i.type=$("body").find('input[name="_attachment_sale_type"]').val();i.files=n;i.external=t;$.post(admin_url+"misc/add_sales_external_attachment",i).done(function(){i.type=="estimate"?$("body").hasClass("estimates-pipeline")?estimate_pipeline_open(i.rel_id):init_estimate(i.rel_id):i.type=="proposal"?$("body").hasClass("proposals-pipeline")?proposal_pipeline_open(i.rel_id):init_proposal(i.rel_id):typeof window["init_"+i.type]=="function"&&window["init_"+i.type](i.rel_id);$("#sales_attach_file").modal("hide")})}function set_search_history(n){for(var r=$("#search-history"),i="",t=0;t<n.length;t++)i+='<li data-index="'+t+'"><a href="#" class="history">'+n[t]+' <span class="remove-history pointer pull-right" style="z-index:1500"><i class="fa fa-remove"><\/i><\/span><\/a><\/li>';r.html(i)}function requestGet(n,t){t=typeof t=="undefined"?{}:t;var i={type:"GET",url:n.indexOf(admin_url)>-1?n:admin_url+n};return $.ajax($.extend({},i,t))}function requestGetJSON(n,t){return t=typeof t=="undefined"?{}:t,t.dataType="json",requestGet(n,t)}function initDatatableOffline(n){console.warn('"initDatatableOffline" is deprecated, use "initDataTableInline" instead.');initDataTableInline(n)}function init_currency_symbol(){console.warn('"init_currency_symbol" is deprecated, use "init_currency" instead');init_currency()}$("aside a").click(function(){$(this).attr("href")!="#"&&$(this).attr("target")!="_blank"&&showLoader()});$(document).on("keyup",'input[name="name"], input[name="firstname"], input[name="organisation"], input[name="issue_name"], input[name="milestones[]"], input[name="region_name"]',function(){name=$(this).val();const n=name.charAt(0).toUpperCase()+name.slice(1);$(this).val(n)});$(window).load(function(){$("body").addClass("loaded");$("#loader-wrapper").remove()});$(".menu-item-master_plan").find("a").attr("target","_blank");$(".sub-menu-item-edit_master_plan").find("a").attr("target","");$(document).on("click",".modal-backdrop",function(){$("button.close, .assign-modal button.btn-default").trigger("click")});$(document).on("change","select",function(){$(this).next("button").hasClass("bs-placeholder")?$(this).closest(".form-select-field").find(".select-label").removeClass("label-up-select"):$(this).closest(".form-select-field").find(".select-label").addClass("label-up-select")});$(document).on("show.bs.modal","#assignTicketPopup,#rejectTicketPopup",function(){$(".lightgallery").lightGallery()});$(document).on("change",".singleSelect select",function(){$(".singleSelect select option:selected").val()==""&&$(this).closest(".singleSelect").find(".select-label").removeClass("label-up-select")});$(document).click(function(){$(".btn-container").siblings().find("ul").slideUp("fast")});$(document).on("click",".btn-container .btn",function(n){$(this).closest(".btn-container").siblings().find("ul").slideUp("fast");$(this).closest(".dashboard-row").siblings().find("ul").slideUp("fast");$(this).next("ul").slideToggle();n.stopPropagation()});$(document).ready(function(){if($("body").hasClass("page-small")&&$("body").addClass("hide-sidebar"),$(window).width()<769){var n=$("#header").height();$("#wrapper").css("margin-top",n+10+"px")}$(window).width()<991&&($(".dashboardModal").removeClass("mCustomScrollbar"),$(".dashboardModal").mCustomScrollbar("destroy"));$("body").on("show.bs.modal","#ticketDetailsPopup",function(){$(".dashboardModal").removeClass("mCustomScrollbar");$(".dashboardModal").mCustomScrollbar("destroy")});$(".modal").on("hidden.bs.modal",function(){this.className!=="modal fade sidebarModal dash-filter"&&($(this).find("form").find("select").val("default").selectpicker("refresh"),$(this).find("form").trigger("reset"),$(this).find("form").find(".select-label").removeClass("label-up-select"),$(".text-danger").css("display","none"),$(".floatingBtn").remove(),$(".form-input-field input").val()!==""&&$(this).addClass("label-up"))})});$(document).on("click","a[href='#ticket-history']",function(){$("body").append('<button class="floatingBtn scroll-bottom btn btn-custom"><i class="fa fa-angle-double-down" aria-hidden="true"><\/i> Go to Latest<\/button>')});$(document).on("click","a[href='#ticket-details']",function(){$(".floatingBtn").remove()});$(document).on("click",".floatingBtn",function(){let i=$("#ticket-history").innerHeight(),n=$(".ticket-data").innerHeight(),t=window.innerHeight;console.log("Awnish-divHeight",n,i,t);$(".floatingBtn").hasClass("scroll-bottom")?($(".floatingBtn").html('<i class="fa fa-angle-double-up" aria-hidden="true"><\/i> Go to Oldest'),$(".floatingBtn").addClass("scroll-top"),$(".floatingBtn").removeClass("scroll-bottom"),$(".mCustomScrollbar").find(".mCSB_container, .mCSB_dragger").animate({top:t-n-26},500),$("#ticketDetailsPopup.modal").animate({scrollTop:$("#ticketDetailsPopup.modal .modal-body").height()},1e3),$(".mCustomScrollbar").find(".mCSB_dragger").animate({top:0},500)):($(".floatingBtn").html('<i class="fa fa-angle-double-down" aria-hidden="true"><\/i> Go to Latest'),$(".floatingBtn").addClass("scroll-bottom"),$(".floatingBtn").removeClass("scroll-top"),$(".mCustomScrollbar").find(".mCSB_container").animate({top:0},500),$(".mCustomScrollbar").find(".mCSB_dragger").animate({bottom:0},500),$(".mobile.modal-open .modal").animate({top:0},500),$("#ticketDetailsPopup.modal").animate({scrollTop:0},1e3))});$(document).on("click",".show_milestone",function(){tr_id=$(this).attr("id");console.log(tr_id);$(this).hasClass("plus")?($(this).html('<i class="fa fa-minus-square-o"><\/i>'),$(this).removeClass("plus"),$(this).parents("tr").addClass("dt_bold"),$("tr.milestone."+tr_id).show()):($(this).html('<i class="fa fa-plus-square-o"><\/i>'),$(this).addClass("plus"),$(this).parents("tr").removeClass("dt_bold"),$("tr.milestone."+tr_id).hide())});$(document).on("blur",".form-input-field input",function(){$(this).val()!==""?$(this).addClass("label-up"):$(this).removeClass("label-up")});$(document).on("focus",".form-textarea",function(){$(this).addClass("label-up")});$(document).on("blur",".form-textarea",function(){$(this).val()!==""?$(this).addClass("label-up"):$(this).removeClass("label-up")});$(document).on("click","ul.dt-button-collection.dropdown-menu > li > a",function(){$(".dt-button-background").trigger("click")});$(document).ajaxStop(function(){$("#wrapper").waitMe("hide");$(".modal").waitMe("hide")});$(document).ajaxStart(function(){$container=$("body").find(".modal").is(":visible")?".modal":"#wrapper";console.log($container);add_loader($container)});$(window).on("load",function(){$(".header-search button").on("click",function(){$(".header-search").toggleClass("show-search")});$(".header-search.show-search input").blur(function(){$(".header-search.show-search").removeClass("show-search")});init_btn_with_tooltips()});$.fn.dataTable.ext.errMode="throw";$.fn.dataTableExt.oStdClasses.sWrapper="dataTables_wrapper form-inline dt-bootstrap table-loading";app.options.enable_google_picker=="1"&&($.fn.googleDrivePicker.defaults.clientId=app.options.google_client_id,$.fn.googleDrivePicker.defaults.developerKey=app.options.google_api);Dropzone.options.newsFeedDropzone=!1;Dropzone.options.salesUpload=!1;"Notification"in window&&app.options.desktop_notifications=="1"&&Notification.requestPermission();var original_top_search_val,table_leads,table_activity_log,table_estimates,table_invoices,table_tasks,tab_active=get_url_param("tab"),tab_group=get_url_param("group"),side_bar=$("#side-menu"),content_wrapper=$("#wrapper"),setup_menu=$("#setup-menu-wrapper"),menu_href_selector,calendar_selector=$("#calendar"),notifications_wrapper=$("#header").find("li.notifications-wrapper"),doc_initial_title=document.title,newsfeed_posts_page=0,track_load_post_likes=0,track_load_comment_likes=0,post_likes_total_pages=0,comment_likes_total_pages=0,select_picker_validated_event=!1,postid=0,setup_menu_item=$("#setup-menu-item");$("body").on("loaded.bs.select change","select.ajax-search",function(){var n=$(this).selectpicker("val"),t,i,r;$.isArray(n)&&n.length==0||n&&!$(this).is(":disabled")&&(t=$(this).parents(".bootstrap-select.ajax-search"),t.find(".ajax-clear-values").length===0&&(i=$(this).attr("id"),r=t.addClass("ajax-remove-values-option").find("button.dropdown-toggle"),r.after('<span class="pointer ajax-clear-values" onclick="deselect_ajax_search(this); return false;" data-id="'+i+'"><i class="fa fa-remove"><\/i><\/span>')))});$("body").on("rendered.bs.select","select",function(){$(this).parents().removeClass("select-placeholder");$(this).parents(".form-group").find(".select-placeholder").removeClass("select-placeholder")});$("body").on("loaded.bs.select","select",function(){$(this).data("toggle")==1&&$(this).selectpicker("toggle")});$("body").on("loaded.bs.select","._select_input_group",function(){$(this).parents(".form-group").find(".input-group-select .input-group-addon").css("opacity","1")});$(window).on("load resize",function(n){$("body").hasClass("page-small")||set_body_small();setTimeout(function(){mainWrapperHeightFix()},n.type=="load"?150:0)});$(document).on("mousemove",function(n){!is_mobile()&&$("body").hasClass("hide-sidebar")&&n.pageX<=10});$(function(){var r,n,t,s,i,u,h,p,c,l,e,k,a,d,v,y,o,g,nt;totalUnreadNotifications>0&&(document.title="("+totalUnreadNotifications+") "+doc_initial_title);$(".screen-options-btn").on("click",function(){$(".screen-options-area").slideToggle()});$("body").hasClass("has-deprecated-errors")&&function(){var t=$("div:contains('A PHP Error was encountered')"),n=0;$.each(t,function(){n+=$(this).outerHeight();$(this).css("background","#fff")});n>0&&$("#menu, #setup-menu-wrapper").css("top",n+70+"px")}();$("form").has('[data-entities-encode="true"]').on("submit.app.entity",function(){$(this).validate().checkForm()&&$.each($('[data-entities-encode="true"]'),function(){$(this).hasClass("_entities-processed")||($(this).val(htmlEntities($(this).val())),$(this).addClass("_entities-processed"))})});add_hotkey("Shift+C",function(){var t=$("#lead-modal"),i=$("#task-modal"),n;t.is(":visible")?convert_lead_to_customer(t.find('input[name="leadid"]').val()):i.is(":visible")?(n=i.find(".tasks-comments"),n.is(":visible")||n.css("display","block"),init_new_task_comment()):window.location.href=admin_url+"clients/client"});add_hotkey("Shift+I",function(){window.location.href=admin_url+"invoices/invoice"});add_hotkey("Shift+E",function(){var t=$("#lead-modal"),n=$("#task-modal");t.is(":visible")||n.is(":visible")?t.is(":visible")?$("a[lead-edit]").click():n.is(":visible")&&edit_task(n.find("[data-task-single-id]").attr("data-task-single-id")):window.location.href=admin_url+"estimates/estimate"});add_hotkey("Shift+F",function(){var t=$("#task-modal"),n;t.is(":visible")&&(n=t.find("[data-task-single-id]"),n.attr("data-status")!=5&&mark_complete(n.attr("data-task-single-id")))});add_hotkey("Ctrl+Shift+P",function(){window.location.href=admin_url+"proposals/proposal"});add_hotkey("Ctrl+Shift+E",function(){window.location.href=admin_url+"expenses/expense"});add_hotkey("Shift+L",function(){init_lead()});add_hotkey("Shift+T",function(){var n=$(".new-task-relation");n.length>0?new_task(admin_url+"tasks/task?rel_id="+n.attr("data-rel-id")+"&rel_type="+n.attr("data-rel-type")):$("body").hasClass("project")?new_task(admin_url+"tasks/task?rel_id="+project_id+"&rel_type=project"):new_task()});add_hotkey("Shift+P",function(){window.location.href=admin_url+"projects/project"});add_hotkey("Shift+S",function(){window.location.href=admin_url+"tickets/add"});add_hotkey("Ctrl+Shift+S",function(){window.location.href=admin_url+"staff/member"});add_hotkey("Ctrl+Shift+L",function(){logout()});add_hotkey("Alt+D",function(){window.location.href=admin_url});add_hotkey("Alt+C",function(){window.location.href=admin_url+"clients"});add_hotkey("Alt+T",function(){window.location.href=admin_url+"tasks/list_tasks"});add_hotkey("Alt+I",function(){window.location.href=admin_url+"invoices/list_invoices"});add_hotkey("Alt+E",function(){window.location.href=admin_url+"estimates/list_estimates"});add_hotkey("Alt+P",function(){window.location.href=admin_url+"projects"});add_hotkey("Alt+L",function(){window.location.href=admin_url+"leads"});add_hotkey("Ctrl+Alt+T",function(){window.location.href=admin_url+"tickets"});add_hotkey("Ctrl+Alt+E",function(){window.location.href=admin_url+"expenses/list_expenses"});add_hotkey("Alt+R",function(){window.location.href=admin_url+"reports/sales"});add_hotkey("Alt+S",function(){window.location.href=admin_url+"settings"});add_hotkey("Shift+K",function(){$("#search_input").focus()});add_hotkey("Shift+D",function(){$("body .dataTables_wrapper").eq(0).find(".dataTables_filter input").focus()});$.Shortcuts.start();$(document).on("focusin",function(n){$(n.target).closest(".mce-window").length&&n.stopImmediatePropagation()});app.options.show_setup_menu_item_only_on_hover!=1||is_mobile()||side_bar.hover(function(){setTimeout(function(){setup_menu_item.css("display","block")},200)},function(){setTimeout(function(){setup_menu_item.css("display","none")},1e3)});r=$("body").find("ul.nav-tabs");tab_active&&r.find('[href="#'+tab_active+'"]').click();tab_group&&(r.find("li").not('[role="presentation"]').removeClass("active"),r.find('[data-group="'+tab_group+'"]').parents("li").addClass("active"));moment.locale(app.locale);moment().tz(app.options.timezone).format();init_editor();$("body").on("click","#started-timers-top,.popover-top-timer-note",function(n){n.stopPropagation()});init_tags_inputs();init_color_pickers();initDataTableInline();$("body").on("change",".onoffswitch input",function(){var n=$(this).data("switch-url");n&&switch_field(this)});custom_fields_hyperlink();init_lightbox();init_progress_bars();init_datepicker();$(document).on("app.form-validate",function(n,t){if(select_picker_validated_event===!0)return!0;select_picker_validated_event=!0;$(t).on("change","select.ajax-search, select.selectpicker",function(){if($(this).selectpicker("val")&&!$(this).is(":disabled")&&typeof $(this).rules()!="undefined"&&Object.keys($(this).rules()).length===1&&$(this).rules().hasOwnProperty("required")){var n=$(this).parents(".form-group");n.find("#"+$(this).attr("name")+"-error").hide();n.removeClass("has-error")}})});if(init_selectpicker(),set_body_small(),init_form_reminder(),init_ajax_search("customer","#clientid.ajax-search"),n=side_bar.find('li > a[href="'+location+'"]'),n.length&&(n.parents("li").not(".quick-links").addClass("active"),n.prop("aria-expanded",!0),n.parents("ul.nav-second-level").prop("aria-expanded",!0),n.parents("li").find("a:first-child").prop("aria-expanded",!0)),setup_menu.hasClass("display-block")&&(t=setup_menu.find('li > a[href="'+location+'"]'),t.length&&(t.parents("li").addClass("active"),t.prev("active"),t.parents("ul.nav-second-level").prop("aria-expanded",!0),t.parents("li").find("a:first-child").prop("aria-expanded",!0))),side_bar.metisMenu(),setup_menu.metisMenu(),$(".hide-menu").click(function(n){n.preventDefault();$("body").hasClass("hide-sidebar")?$("body").removeClass("hide-sidebar").addClass("show-sidebar"):$("body").removeClass("show-sidebar").addClass("hide-sidebar");setup_menu.hasClass("display-block")&&$(".close-customizer").click();delay(function(){$($.fn.dataTable.tables(!0)).DataTable().responsive.recalc()},300)}),is_mobile())content_wrapper.on("click",function(){$("body").hasClass("show-sidebar");setup_menu.hasClass("display-block")&&$(".close-customizer").click()});if(app.browser=="safari")$("body").on("input",".bootstrap-select .bs-searchbox input",function(){$(this).trigger("keyup")});mainWrapperHeightFix();init_tabs_scrollable();$("#top-timers").on("click",function(){init_timers()});set_search_history(app.user_recent_searches);$("#search-history").on("click",".remove-history",function(n){n.stopImmediatePropagation();n.preventDefault();var t=$(this).parents("li").index();requestGet("misc/remove_recent_search/"+t).done(function(){var n=$("#search-history");n.find("li:eq("+t+")").remove();n.find("li").length==0&&n.removeClass("display-block")})});$("#search_input").on("click focus",function(){if($(this).val()==""){var n=$("#search-history");n.find("li").length>0?(n.css("width",$(this).outerWidth()+"px"),n.addClass("display-block")):n.addClass("display-block")}});$("#search-history").on("click","a.history",function(n){n.preventDefault();var t=$(this).text().trim();$("#search_input").val(t);$("#search_input").trigger("paste")});$("#search_input").on("keyup paste"+(app.browser=="safari"?" input":""),function(){var t=$("#search-history");t.removeClass("display-block");var n=$(this).val().trim(),i=$("#search_results"),r=$("#top_search_button button");if(n===""){content_wrapper.unhighlight();i.html("");original_top_search_val="";r.html('<i class="fa fa-search"><\/i>').removeClass("search_remove");t.addClass("display-block");return}n.length<2&&app.user_language.indexOf("chinese")===-1&&app.user_language.indexOf("japanese")===-1||(r.html('<i class="fa fa-remove"><\/i>').addClass("search_remove"),delay(function(){n!=original_top_search_val&&$.post(admin_url+"misc/search",{q:n}).done(function(t){t=JSON.parse(t);content_wrapper.unhighlight();i.html(t.results);content_wrapper.highlight(n);original_top_search_val=n;set_search_history(t.history)})},700))});s=get_url_param("q");s&&$("#search_input").val(s).trigger("keyup");$("body").on("blur","#timesheet_duration",function(){var r=$(this),t=$(this).val(),n,i;t=t.replace(/[^0-9:]/gi,"");t.indexOf(":")>-1?(n=t.split(":"),n[0].length===0&&(n[0]="00"),n[1]>=60&&(i=Math.floor(parseInt(n[1]/60)),n[0]=i+parseInt(n[0]),n[1]=n[1]-i*60),n[0].toString().length===1&&(n[0]="0"+n[0]),n[1].toString().length===1?n[1]="0"+n[1]:n[1].toString().length===0&&(n[1]="00"),t=n[0]+":"+n[1]):t.length===1&&t.indexOf(":")===-1?t="0"+t+":00":t.length>=2&&t.indexOf(":")===-1&&(t=t+":00");t=t=="00:00"?"":t;r.val(t)});$("body").on("click",".timesheet-toggle-enter-type",function(n){n.preventDefault();var t=$(this).find("span.switch-to").removeClass("switch-to").addClass("hide");$(this).find("span").not(t).removeClass("hide").addClass("switch-to");$(".timesheet-start-end-time, .timesheet-duration").toggleClass("hide");$(".timesheet-start-end-time input").val("");$(".timesheet-duration input").val("")});$("body").on("hidden.bs.modal",".modal-reminder",function(){var n=$(this),t=n.find('input[name="rel_id"]').val(),i=n.find('input[name="rel_type"]').val();n.find("form").attr("action",admin_url+"misc/add_reminder/"+t+"/"+i);n.find("form").removeAttr("data-edit");n.find(":input:not([type=hidden]), textarea").val("");n.find('input[type="checkbox"]').prop("checked",!1);n.find("select").selectpicker("val","")});$("body").on("shown.bs.modal",".modal-reminder",function(){$(this).find('form[data-edit="true"]').length==0&&$(this).find("#date").focus()});$("body").on("click",".delete-reminder",function(){return confirm_delete()&&requestGetJSON($(this).attr("href")).done(function(n){alert_float(n.alert_type,n.message);$("#task-modal").is(":visible")&&_task_append_html(n.taskHtml);reload_reminders_tables()}),!1});$("body").on("keypress",'textarea[name="checklist-description"]',function(n){if(n.which=="13"){var t=$(this);return update_task_checklist_item(t).done(function(){add_task_checklist_item(t.attr("data-taskid"))}),!1}});$("body").on("blur paste",'textarea[name="checklist-description"]',function(){update_task_checklist_item($(this))});$("body").on("show.bs.select","select.checklist-items-template-select",_make_task_checklist_items_deletable);$("body").on("refreshed.bs.select","select.checklist-items-template-select",_make_task_checklist_items_deletable);$("body").on("changed.bs.select","select.custom-field-multi-select",function(){var n=$(this).val();$(this).find('option[value=""]').prop("selected",n.length===0?!0:!1);$(this).selectpicker("refresh")});$("body").on("change",".task-single-inline-field",function(){var r=$("body").find(".task-single-inline-field"),n={},t,i;$.each(r,function(){var t=$(this).attr("name"),i=$(this).val(),r=$(this).parents(".task-single-inline-wrap");t=="startdate"&&i===""?r.addClass("text-danger"):t=="startdate"&&i!==""&&r.removeClass("text-danger");(t=="startdate"&&i!==""||t!="startdate")&&(n[$(this).attr("name")]=i,t!="startdate"&&i===""?r.css("opacity",.5):r.css("opacity",1))});t=$("#task-modal");i=t.find("[data-task-single-id]").attr("data-task-single-id");$.post(admin_url+"tasks/task_single_inline_update/"+i,n)});$("body").on("change","#task-modal #checklist_items_templates",function(){var i=$(this).val(),n=$(this).find('option[value="'+i+'"]').html().trim(),t;n!==""&&(t=$("#task-modal"),add_task_checklist_item(t.find("[data-task-single-id]").attr("data-task-single-id"),n),$(this).selectpicker("val",""))});$("body").on("click",".task-date-as-comment-id",function(n){n.preventDefault();var t=$(this).attr("href").split("#"),i=$("#"+t[t.length-1]).position();$("#task-modal").scrollTop(i.top)});$("body").on("click","table.dataTable tbody .tags-labels .label-tag",function(){$(this).parents("table").DataTable().search($(this).find(".tag").text()).draw();$("div.dataTables_filter input").focus()});$("body").on("click","table.dataTable tbody .customer-group-list",function(){$(this).parents("table").DataTable().search($(this).text()).draw();$("div.dataTables_filter input").focus()});$("[data-can-view-own], [data-can-view]").on("change",function(){var n=$(this).attr("data-can-view-own");(view_chk_selector=$(this).parents("tr").find("td input["+(typeof n!=typeof undefined&&n!==!1?"data-can-view":"data-can-view-own")+"]"),view_chk_selector.data("not-applicable")!=!0)&&(view_chk_selector.prop("checked",!1),view_chk_selector.prop("disabled",$(this).prop("checked")===!0))});typeof taskid!="undefined"&&taskid!==""&&init_task_modal(taskid);$("body").on("change",'input[name="checklist-box"]',function(){requestGet(admin_url+"tasks/checkbox_action/"+$(this).parents(".checklist").data("checklist-id")+"/"+($(this).prop("checked")===!0?1:0));recalculate_checklist_items_progress()});$("body").on("keyup paste click","textarea[name='checklist-description']",function(){do_task_checklist_items_height($(this))});$("body").on("click focus","#task_comment",function(){init_new_task_comment()});$("body").on("click",".task-single-delete-timesheet",function(n){if(n.preventDefault(),confirm_delete()){var t=$(this).data("task-id");requestGet($(this).attr("href")).done(function(){init_task_modal(t);setTimeout(function(){reload_tasks_tables();init_timers()},20)})}});$("body").on("click",".task-single-add-timesheet",function(n){var t;n.preventDefault();var i=$("body").find('#task-modal input[name="timesheet_start_time"]').val(),r=$("body").find('#task-modal input[name="timesheet_end_time"]').val(),u=$("body").find('#task-modal input[name="timesheet_duration"]').val();(i!==""&&r!==""||u!=="")&&(t={},t.timesheet_duration=u,t.start_time=i,t.end_time=r,t.timesheet_task_id=$(this).data("task-id"),t.note=$("body").find("#task_single_timesheet_note").val(),t.timesheet_staff_id=$("body").find('#task-modal select[name="single_timesheet_staff_id"]').val(),$.post(admin_url+"tasks/log_time",t).done(function(n){n=JSON.parse(n);n.success===!0||n.success=="true"?(init_task_modal(t.timesheet_task_id),alert_float("success",n.message),setTimeout(function(){reload_tasks_tables()},20)):alert_float("warning",n.message)}))});$("body").on("click",".copy_task_action",function(){var n={};return $(this).prop("disabled",!0),n.copy_from=$(this).data("task-copy-from"),n.copy_task_assignees=$("body").find("#copy_task_assignees").prop("checked"),n.copy_task_followers=$("body").find("#copy_task_followers").prop("checked"),n.copy_task_checklist_items=$("body").find("#copy_task_checklist_items").prop("checked"),n.copy_task_attachments=$("body").find("#copy_task_attachments").prop("checked"),n.copy_task_status=$("body").find('input[name="copy_task_status"]:checked').val(),$.post(admin_url+"tasks/copy",n).done(function(n){if(n=JSON.parse(n),n.success===!0||n.success=="true"){var t=$("#_task_modal");t.is(":visible")&&t.modal("hide");init_task_modal(n.new_task_id);reload_tasks_tables()}alert_float(n.alert_type,n.message)}),!1});$("body").on("click",".new-task-to-milestone",function(n){n.preventDefault();var t=$(this).parents(".milestone-column").data("col-status-id");new_task(admin_url+"tasks/task?rel_type=project&rel_id="+project_id+"&milestone_id="+t);$('body [data-toggle="popover"]').popover("hide")});$("body").on("shown.bs.modal","#_task_modal",function(n){$(n.currentTarget).hasClass("edit")?$(this).find(".tinymce-task").val().trim()!==""&&init_editor(".tinymce-task",{height:200}):$("body").find("#_task_modal #name").focus();init_tags_inputs()});$("body").on("hidden.bs.modal","#_task_modal",function(){tinyMCE.remove(".tinymce-task");typeof _ticket_message!="undefined"&&(_ticket_message=undefined);$(this).attr("data-lead-id")==undefined||$(this).attr("data-task-created")||init_lead($(this).attr("data-lead-id"));destroy_dynamic_scripts_in_element($("body #_task_modal"));$("#_task").empty()});$("body").on("hide.bs.modal","#task-modal",function(){if($("#lightbox").is(":visible")==!0)return!1;typeof taskAttachmentDropzone!="undefined"&&taskAttachmentDropzone.destroy();tinyMCE.remove("#task_view_description")});$("body").on("hidden.bs.modal","#task-modal",function(){destroy_dynamic_scripts_in_element($(this));$(this).find(".data").empty()});$("body").on("shown.bs.modal","#task-modal",function(){var t,n;do_task_checklist_items_height();init_tags_inputs();fix_task_modal_left_col_height();$(document).off("focusin.modal");t=window.location.href;t.indexOf("#comment_")>-1&&(n=t.split("#comment_"),n=n[n.length-1],$('[data-task-comment-href-id="'+n+'"]').click())});$("body").on("blur","#task-modal ul.tagit li.tagit-new input",function(){setTimeout(function(){task_single_update_tags()},100)});$("body").on("change",'select[name="select-assignees"]',function(){$("body").append('<div class="dt-loader"><\/div>');var n={};n.assignee=$('select[name="select-assignees"]').val();n.assignee!==""&&(n.taskid=$(this).attr("data-task-id"),$.post(admin_url+"tasks/add_task_assignees",n).done(function(n){$("body").find(".dt-loader").remove();n=JSON.parse(n);reload_tasks_tables();_task_append_html(n.taskHtml)}))});$("body").on("change",'select[name="select-followers"]',function(){var n={};n.follower=$('select[name="select-followers"]').val();n.follower!==""&&(n.taskid=$(this).attr("data-task-id"),$("body").append('<div class="dt-loader"><\/div>'),$.post(admin_url+"tasks/add_task_followers",n).done(function(n){n=JSON.parse(n);$("body").find(".dt-loader").remove();_task_append_html(n.taskHtml)}))});$("body").on("click",".close-task-stats",function(){$("#task-tracking-stats-modal").modal("hide")});$("body").on("hidden.bs.modal","#task-tracking-stats-modal",function(){$("#tracking-stats").remove()});$("body").on("show.bs.modal","#task-tracking-stats-modal",function(){var n=$("body").find("#task-tracking-stats-chart");setTimeout(function(){typeof taskTrackingChart!="undefined"&&taskTrackingChart.destroy();taskTrackingChart=new Chart(n,{type:"line",data:taskTrackingStatsData,options:{legend:{display:!1},responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!0,mode:"single",callbacks:{label:function(n){return decimalToHM(n.yLabel)}}},scales:{yAxes:[{ticks:{beginAtZero:!0,min:0,userCallback:function(n){return decimalToHM(n)}}},]}}})},800)});$("body").on("shown.bs.modal","#sync_data_proposal_data",function(){$("#sync_data_proposal_data").data("rel-type")=="lead"&&$("#lead-modal .data").eq(0).css("height",$("#sync_data_proposal_data .modal-content").height()+80+"px").css("overflow-x","hidden")});$("body").on("hidden.bs.modal","#sync_data_proposal_data",function(){$("#sync_data_proposal_data").data("rel-type")=="lead"&&$("#lead-modal .data").prop("style","")});typeof openLeadID!="undefined"&&openLeadID!==""&&init_lead(openLeadID,get_url_param("edit")?!0:!1);$("body").on("click",".leads-kan-ban .cpicker",function(){var n=$(this).data("color"),t=$(this).parents(".panel-heading-bg").data("status-id");$.post(admin_url+"leads/change_status_color",{color:n,status_id:t})});$("body").on("click","[lead-edit]",function(n){var i,t,r;n.preventDefault();i=$("body .lead-edit");$("body .lead-view").toggleClass("hide");i.toggleClass("hide");i.hasClass("hide")||(t=$("#lead-modal").find("#address"),r=t[0].scrollHeight,t.is("textarea")&&(t.height(0).height(r-15),t.css("padding-top","9px")))});$("body").on("click",".new-lead-from-status",function(n){n.preventDefault();var t=$(this).parents(".kan-ban-col").data("col-status-id");init_lead_modal_data(undefined,admin_url+"leads/lead?status_id="+t);$('body [data-toggle="popover"]').popover("hide")});$("body").on("change","input.include_leads_custom_fields",function(){var t=$(this).val(),n=$(this).data("field-id");t==2?$("#merge_db_field_"+n).removeClass("hide"):$("#merge_db_field_"+n).addClass("hide");t==3?$("#merge_db_contact_field_"+n):$("#merge_db_contact_field_"+n).addClass("hide")});if(calendar_selector.length>0){if(validate_calendar_form(),i={themeSystem:"bootstrap3",customButtons:{},header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay,viewFullCalendar,calendarFilter"},editable:!1,eventLimit:parseInt(app.options.calendar_events_limit)+1,views:{day:{eventLimit:!1}},defaultView:app.options.default_view_calendar,isRTL:isRTL=="true"?!0:!1,eventStartEditable:!1,timezone:app.options.timezone,firstDay:parseInt(app.options.calendar_first_day),year:moment.tz(app.options.timezone).format("YYYY"),month:moment.tz(app.options.timezone).format("M"),date:moment.tz(app.options.timezone).format("DD"),loading:function(n){n&&$("#calendar .fc-header-toolbar .btn-default").addClass("btn-info").removeClass("btn-default").css("display","block");n?$(".dt-loader").removeClass("hide"):$(".dt-loader").addClass("hide")},eventSources:[{url:admin_url+"utilities/get_calendar_data",data:function(){var n={};return $("#calendar_filters").find("input:checkbox:checked").map(function(){n[$(this).attr("name")]=!0}).get(),jQuery.isEmptyObject(n)||(n.calendar_filters=!0),n},type:"POST",error:function(){console.error("There was error fetching calendar data")}},],eventLimitClick:function(n){$("#calendar").fullCalendar("gotoDate",n.date);$("#calendar").fullCalendar("changeView","basicDay")},eventRender:function(n,t){t.attr("title",n._tooltip);t.attr("onclick",n.onclick);t.attr("data-toggle","tooltip");n.url||t.click(function(){view_event(n.eventid)})},dayClick:function(n){var t=n.format();$.fullCalendar.moment(t).hasTime()||(t+=" 00:00");var i=app.options.time_format==24?app.options.date_format+" H:i":app.options.date_format+" g:i A",r=new DateFormatter,u=r.formatDate(new Date(t),i);return $("input[name='start'].datetimepicker").val(u),$("#newEventModal").modal("show"),!1}},$("body").hasClass("dashboard")&&(i.customButtons.viewFullCalendar={text:app.lang.calendar_expand,click:function(){window.location.href=admin_url+"utilities/calendar"}}),i.customButtons.calendarFilter={text:app.lang.filter_by.toLowerCase(),click:function(){slideToggle("#calendar_filters")}},app.user_is_staff_member==1&&(app.options.google_api!==""&&(i.googleCalendarApiKey=app.options.google_api),app.calendarIDs!==""&&(app.calendarIDs=JSON.parse(app.calendarIDs),app.calendarIDs.length!=0)))if(app.options.google_api!=="")for(u=0;u<app.calendarIDs.length;u++)h={},h.googleCalendarId=app.calendarIDs[u],i.eventSources.push(h);else console.error("You have setup Google Calendar IDs but you dont have specified Google API key. To setup Google API key navigate to Setup->Settings->Google");calendar_selector.fullCalendar(i);p=get_url_param("new_event");p&&($("input[name='start'].datetimepicker").val(get_url_param("date")),$("#newEventModal").modal("show"))}$("body").on("change",'select[name="tax"]',function(){var n=$("body").find('select[name="tax2"]'),t=$(this);t.val()!==""?n.prop("disabled",!1):(n.prop("disabled",!0),n.val()!==""&&(t.selectpicker("val",n.val()),n.val(""),t.selectpicker("refresh")));n.selectpicker("refresh")});$("body").on("click","#invoice_create_credit_note",function(n){if($(this).attr("data-status")==2)return!0;var t=$("#confirm_credit_note_create_from_invoice");t.modal("show");t.find("#confirm-invoice-credit-note").attr("href",$(this).attr("href"));n.preventDefault()});$("body").on("change blur",".apply-credits-to-invoice .apply-credits-field",function(){var n=$("#apply_credits"),r=n.find("input.apply-credits-field"),t=0,i=n.attr("data-credits-remaining");$.each(r,function(){if($(this).valid()===!0){var n=$(this).val();n=parseFloat(n);isNaN(n)?$(this).val(0):t+=n}});n.find("#credits-alert").remove();n.find(".amount-to-credit").html(format_money(t));i<t?($(".credits-table").before($("<div/>",{id:"credits-alert","class":"alert alert-danger"}).html(app.lang.credit_amount_bigger_then_credit_note_remaining_credits)),n.find('[type="submit"]').prop("disabled",!0)):(n.find(".credit-note-balance-due").html(format_money(i-t)),n.find('[type="submit"]').prop("disabled",!1))});$("body").on("change blur",".apply-credits-from-invoice .apply-credits-field",function(){var n=$("#apply_credits"),r=n.find("input.apply-credits-field"),t=0,i=n.attr("data-balance-due");$.each(r,function(){if($(this).valid()===!0){var n=$(this).val();n=parseFloat(n);isNaN(n)?$(this).val(0):t+=n}});n.find("#credits-alert").remove();n.find(".amount-to-credit").html(format_money(t));t>i?($(".credits-table").before($("<div/>",{id:"credits-alert","class":"alert alert-danger"}).html(app.lang.credit_amount_bigger_then_invoice_balance)),n.find('[type="submit"]').prop("disabled",!0)):(n.find(".invoice-balance-due").html(format_money(i-t)),n.find('[type="submit"]').prop("disabled",!1))});$('input[name="notify_type"]').on("change",function(){var n=$('input[name="notify_type"]:checked').val(),t=$("#specific_staff_notify"),i=$("#role_notify");n=="specific_staff"?(t.removeClass("hide"),i.addClass("hide")):n=="roles"?(t.addClass("hide"),i.removeClass("hide")):n=="assigned"&&(t.addClass("hide"),i.addClass("hide"))});$("body").on("shown.bs.modal","#lead-modal",function(){custom_fields_hyperlink();$("body").find('#lead-modal input[name="leadid"]').length===0&&$("body").find('#lead-modal input[name="name"]').focus();init_tabs_scrollable();$("body").find(".lead-wrapper").hasClass("open-edit")&&$("body").find("a[lead-edit]").click()});$("body").on("show.bs.modal","#lead-modal",function(){$("#lead-more-dropdown").find("li").length==0&&$("#lead-more-btn").css("opacity",0).css("pointer-events","none")});$("#lead-modal").on("hidden.bs.modal",function(){destroy_dynamic_scripts_in_element($(this));$(this).data("bs.modal",null);$("#lead_reminder_modal").html("");$("#lead-modal").is(":visible")||history.pushState("",document.title,window.location.pathname+window.location.search);$("body #lead-modal .datetimepicker").datetimepicker("destroy");typeof leadAttachmentsDropzone!="undefined"&&leadAttachmentsDropzone.destroy()});$("body").on("submit","#lead-modal .consent-form",function(){var n=$(this).serialize();return $.post($(this).attr("action"),n).done(function(n){n=JSON.parse(n);init_lead_modal_data(n.lead_id)}),!1});$("body").on("click",'#lead-modal a[data-toggle="tab"]',function(){this.hash=="#tab_lead_profile"||this.hash=="#attachments"||this.hash=="#lead_notes"||this.hash=="#gdpr"||this.hash=="#lead_activity"?window.location.hash=this.hash:history.pushState("",document.title,window.location.pathname+window.location.search);$(document).resize()});$("body").on("click","#lead_enter_activity",function(){var n=$("#lead_activity_textarea").val(),t=$("#lead-modal").find('input[name="leadid"]').val();n!==""&&$.post(admin_url+"leads/add_activity",{leadid:t,activity:n}).done(function(n){n=JSON.parse(n);_lead_init_data(n,n.id)}).fail(function(n){alert_float("danger",n.responseText)})});$("body").on("submit","#lead-modal #lead-notes",function(){var n=$(this),t=$(n).serialize();return $.post(n.attr("action"),t).done(function(n){n=JSON.parse(n);_lead_init_data(n,n.id)}).fail(function(n){alert_float("danger",n.responseText)}),!1});if(c={custom_view:"[name='custom_view']",assigned:"[name='view_assigned']",status:"[name='view_status[]']",source:"[name='view_source']"},table_leads=$("table.table-leads"),table_leads.length){var f=table_leads.find("#th-consent"),w=[0],b=[0,table_leads.find("#th-assigned").index()];if(f.length>0&&(w.push(f.index()),b.push(f.index())),_table_api=initDataTable(table_leads,admin_url+"leads/table",b,w,c,[table_leads.find("th.date-created").index(),"desc"]),_table_api&&f.length>0)_table_api.on("draw",function(){var n=table_leads.find("tbody tr");$.each(n,function(){$(this).find("td:eq(3)").addClass("bg-light-gray")})});$.each(c,function(n,t){$("select"+t).on("change",function(){$("[name='view_status[]']").prop("disabled",$(this).val()=="lost"||$(this).val()=="junk").selectpicker("refresh");table_leads.DataTable().ajax.reload().columns.adjust().responsive.recalc()})})}$("body").on("change",'input[name="contacted_today"]',function(){var t=$(this).prop("checked"),n=$(".lead-select-date-contacted");t==!1?n.removeClass("hide"):n.addClass("hide")});$("body").on("change",'input[name="contacted_indicator"]',function(){var n=$(".lead-select-date-contacted");$(this).val()=="yes"?n.removeClass("hide"):n.addClass("hide")});$("body").on("click","table.dataTable tbody td:first-child",function(){var i=$(this).parents("tr"),n,t;$(this).parents("table").DataTable().row(i).child.isShown()&&(n=$(i).next().find("input.onoffswitch-checkbox"),n.length>0&&(t=Math.random().toString(16).slice(2),n.attr("id",t).next().attr("for",t)))});$("body").on("click",".close-reminder-modal",function(){$(".reminder-modal-"+$(this).data("rel-type")+"-"+$(this).data("rel-id")).modal("hide")});$("body").on("shown.bs.tab",'a[data-toggle="tab"]',function(){$($.fn.dataTable.tables(!0)).DataTable().responsive.recalc()});$("form").not("#single-ticket-form,#calendar-event-form,#proposal-form").areYouSure();$("body").on("click",".editor-add-content-notice",function(){var n=$(this);setTimeout(function(){n.remove();tinymce.triggerSave()},500)});$(".bulk_actions").on("change",'input[name="mass_delete"]',function(){var n=$("#bulk_change");$(this).prop("checked")===!0&&n.find("select").selectpicker("val","");n.toggleClass("hide");$(".mass_delete_separator").toggleClass("hide")});$("body").on("change loaded.bs.select","#item_select",function(){var t=$(".items-wrapper .items-select-wrapper"),n=$(".items-wrapper .input-group-addon");n.length===0?$(".items-wrapper .bootstrap-select").css("width","100%"):$(".items-wrapper .bootstrap-select").css("width",t.width()-n.width()+12+"px")});$(".send-test-sms").on("click",function(){var n=$(this).data("id"),i=$('#sms_test_response[data-id="'+n+'"]'),t=$('textarea[data-id="'+n+'"]').val(),r=$('input.test-phone[data-id="'+n+'"]').val(),u=$(this);i.empty();t=t.trim();t!=""&&r!=""&&(u.prop("disabled",!0),$.post(window.location.href,{message:t,number:r,id:n,sms_gateway_test:!0}).done(function(n){n=JSON.parse(n);n.success==!0?i.html('<div class="alert alert-success no-mbot mtop15">SMS Sent Successfully!<\/div>'):i.html('<div class="alert alert-warning no-mbot mtop15">'+n.error+"<\/div>")}).always(function(){u.prop("disabled",!1)}))});$("body").on("hidden.bs.modal","#__todo",function(){var n=$("#__todo");n.find('input[name="todoid"]').val("");n.find('textarea[name="description"]').val("");n.find(".add-title").addClass("hide");n.find(".edit-title").addClass("hide")});$("body").on("shown.bs.modal","#__todo",function(){var n=$("#__todo");n.find('textarea[name="description"]').focus();n.find('input[name="todoid"]').val()!==""?(n.find(".add-title").addClass("hide"),n.find(".edit-title").removeClass("hide")):(n.find(".add-title").removeClass("hide"),n.find(".edit-title").addClass("hide"))});$("#top_search_button button").on("click",function(){var n=$("#search_input");$(this).hasClass("search_remove")&&($(this).html('<i class="fa fa-search"><\/i>').removeClass("search_remove"),original_top_search_val="",$("#search_results").html(""),n.val(""));n.focus()});$("body").click(function(n){$(n.target).parents("#top_search_dropdown").hasClass("search-results")||$("#top_search_dropdown").remove()});$("body").tooltip({selector:'[data-toggle="tooltip"]'});$("body").popover({selector:'[data-toggle="popover"]'});$("body").on("click","._filter_data ul.dropdown-menu li a,.not-mark-as-read-inline,.not_mark_all_as_read a",function(n){n.stopPropagation();n.preventDefault()});$("body").on("shown.bs.modal",".modal",function(){$("body").addClass("modal-open");$("body").find("#started-timers-top").parents("li").removeClass("open")});$("body").on("hidden.bs.modal",".modal",function(){$(".modal:visible").length&&$(document.body).addClass("modal-open");$(this).data("bs.modal",null)});$(".datepicker.activity-log-date").on("change",function(){table_activity_log.DataTable().ajax.reload()});$(".btn-import-submit").on("click",function(){$(this).hasClass("simulate")&&$("#import_form").append(hidden_input("simulate",!0));$("#import_form").submit()});$("body").on("change","#unlimited_cycles",function(){$(this).parents(".recurring-cycles").find("#cycles").prop("disabled",$(this).prop("checked"))});$("body").on("change",'[name="repeat_every"], [name="recurring"]',function(){var n=$(this).val();n=="custom"?$(".recurring_custom").removeClass("hide"):$(".recurring_custom").addClass("hide");n!==""&&n!=0?$("body").find("#cycles_wrapper").removeClass("hide"):($("body").find("#cycles_wrapper").addClass("hide"),$("body").find("#cycles_wrapper #cycles").val(0),$("#unlimited_cycles").prop("checked",!0).change())});$("body").on("change","#mass_select_all",function(){var n,t,i;n=$(this).data("to-table");t=$(".table-"+n).find("tbody tr");i=$(this).prop("checked");$.each(t,function(){$($(this).find("td").eq(0)).find("input").prop("checked",i)})});$("body").on("show.bs.modal",".modal.email-template",function(){init_editor($(this).data("editor-id"),{urlconverter_callback:"merge_field_format_url"})});$("body").on("hidden.bs.modal",".modal.email-template",function(){tinymce.remove($(this).data("editor-id"))});$(".close-customizer").on("click",function(n){n.preventDefault();setup_menu.addClass(isRTL=="true"?"fadeOutRight":"fadeOutLeft");requestGet("misc/set_setup_menu_closed")});$(".open-customizer").on("click",function(n){n.preventDefault();setup_menu.hasClass(isRTL=="true"?"fadeOutRight":"fadeOutLeft")&&setup_menu.removeClass(isRTL=="true"?"fadeOutRight":"fadeOutLeft");setup_menu.addClass("display-block "+(isRTL=="true"?"fadeInRight":"fadeInLeft"));is_mobile()||requestGet("misc/set_setup_menu_open");mainWrapperHeightFix()});$("body").on("click",".cpicker",function(){var n=$(this).data("color");if($(this).hasClass("cpicker-big"))return!1;$(this).parents(".cpicker-wrapper").find(".cpicker-big").removeClass("cpicker-big").addClass("cpicker-small");$(this).removeClass("cpicker-small","fast").addClass("cpicker-big","fast");$(this).hasClass("kanban-cpicker")?($(this).parents(".panel-heading-bg").css("background",n),$(this).parents(".panel-heading-bg").css("border","1px solid "+n)):$(this).hasClass("calendar-cpicker")&&$("body").find('._event input[name="color"]').val(n)});$("body").on("click",".notification_link",function(){var n=$(this).data("link"),t;t=n.split("#");t[1]||(window.location.href=n)});$("body").on("click"+(navigator.userAgent.match(/iPad/i)!=null?" touchstart":""),".notifications a.notification-top, .notification_link",function(n){var f,e;n.preventDefault();var r=$(this),i,u=r.hasClass("notification_link")?r.data("link"):n.currentTarget.href,t=u.split("#"),o=!0;t[1]&&t[1].indexOf("=")>-1&&(o=!1,i=t[1].split("=")[1],t[1].indexOf("postid")>-1?(postid=i,$(window).width()>769?$(".open_newsfeed.desktop").click():$(".open_newsfeed.mobile").click()):t[1].indexOf("taskid")>-1?(f=undefined,u.indexOf("#comment_")>-1&&(e=u.split("#comment_"),f=e[e.length-1]),init_task_modal(i,f)):t[1].indexOf("leadid")>-1?init_lead(i):t[1].indexOf("eventid")>-1&&view_event(i));r.hasClass("desktopClick")||r.parent("li").find(".not-mark-as-read-inline").click();o&&setTimeout(function(){window.location.href=t},50)});$(".notifications-wrapper").on("show.bs.dropdown",function(){var n=notifications_wrapper.find(".notifications").attr("data-total-unread");n>0&&$.post(admin_url+"misc/set_notifications_read").done(function(n){n=JSON.parse(n);(n.success===!0||n.success=="true")&&(document.title=doc_initial_title,$(".icon-notifications").addClass("hide"))})});init_table_tickets();init_table_announcements();init_table_staff_projects();table_activity_log=$("table.table-activity-log");table_activity_log.length&&(l=[],l.activity_log_date='[name="activity_log_date"]',initDataTable(table_activity_log,window.location.href,"undefined","undefined",l,[1,"desc"]));table_invoices=$("table.table-invoices");table_estimates=$("table.table-estimates");(table_invoices.length>0||table_estimates.length>0)&&(e={},k=$("._hidden_inputs._filters input"),$.each(k,function(){e[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),table_invoices.length&&initDataTable(table_invoices,admin_url+"invoices/table"+($("body").hasClass("recurring")?"?recurring=1":""),"undefined","undefined",e,$("body").hasClass("recurring")?[table_invoices.find("th.next-recurring-date").index(),"asc"]:[[3,"desc"],[0,"desc"],]),table_estimates.length&&initDataTable(table_estimates,admin_url+"estimates/table","undefined","undefined",e,[[3,"desc"],[0,"desc"],]));table_tasks=$(".table-tasks");table_tasks.length&&(a={},d=$("._hidden_inputs._filters._tasks_filters input"),$.each(d,function(){a[$(this).attr("name")]='[name="'+$(this).attr("name")+'"]'}),v=[0],y=admin_url+"tasks/table",$("body").hasClass("tasks-page")&&(y+="?bulk_actions=true"),_table_api=initDataTable(table_tasks,y,v,v,a,[table_tasks.find("th.duedate").index(),"asc"]),_table_api&&$("body").hasClass("dashboard")&&_table_api.column(5).visible(!1,!1).column(6).visible(!1,!1).columns.adjust());$("#send_file").on("show.bs.modal",function(n){var t=$("#send_file");t.find('input[name="filetype"]').val($($(n.relatedTarget)).data("filetype"));t.find('input[name="file_path"]').val($($(n.relatedTarget)).data("path"));t.find('input[name="file_name"]').val($($(n.relatedTarget)).data("file-name"));$('input[name="email"]').length>0&&t.find('input[name="send_file_email"]').val($('input[name="email"]').val())});$("#send_file form").on("submit",function(){$(this).find('button[type="submit"]').prop("disabled",!0)});$("body").on("change",'input[name="send_set_password_email"]',function(){$("body").find(".client_password_set_wrapper").toggleClass("hide")});$("body").on("change",'.todo input[type="checkbox"]',function(){var n=$(this).prop("checked")===!0?1:0,t=$(this).val();window.location.href=admin_url+"todo/change_todo_status/"+t+"/"+n});o=$(".todos-sortable");o.length>0&&(o=o.sortable({connectWith:".todo",items:"li",handle:".dragger",appendTo:"body",update:function(n,t){this===t.item.parent()[0]&&update_todo_items()}}));$("body").on("click",".open_newsfeed, .close_newsfeed",function(n){n.preventDefault();typeof $(this).data("close")=="undefined"?requestGet("newsfeed/get_data").done(function(n){$("#newsfeed").html(n);load_newsfeed(postid);init_newsfeed_form();init_selectpicker();init_lightbox()}):$(this).data("close")===!0&&(newsFeedDropzone.destroy(),$("#newsfeed").html(""),newsfeed_posts_page=0,track_load_post_likes=0,track_load_comment_likes=0,postid=undefined);$("#newsfeed").toggleClass("hide");$("body").toggleClass("noscroll")});$("[data-newsfeed-auto]").length>0&&($(window).width()>769?$(".open_newsfeed.desktop").click():$(".open_newsfeed.mobile").click());$("body").on("keyup",".comment-input input",function(n){n.keyCode==13&&add_comment(this)});$("#modal_post_likes").on("show.bs.modal",function(n){track_load_post_likes=0;$("#modal_post_likes_wrapper").empty();$(".likes_modal .modal-footer").removeClass("hide");var t=$(n.relatedTarget),i=$(t).data("postid");post_likes_total_pages=$(t).data("total-pages");$(".load_more_post_likes").attr("data-postid",i);load_post_likes(i)});$("#modal_post_comment_likes").on("show.bs.modal",function(n){$("#modal_comment_likes_wrapper").empty();track_load_comment_likes=0;$(".likes_modal .modal-footer").removeClass("hide");var t=$(n.relatedTarget),i=$(t).data("commentid");comment_likes_total_pages=$(t).data("total-pages");$(".load_more_post_comment_likes").attr("data-commentid",i);load_comment_likes(i)});$(".load_more_post_likes").on("click",function(n){n.preventDefault();load_post_likes($(this).data("postid"))});$(".load_more_post_comment_likes").on("click",function(n){n.preventDefault();load_comment_likes($(this).data("commentid"))});$(".add-attachments").on("click",function(n){n.preventDefault();$("#post-attachments").toggleClass("hide")});init_invoices_total();init_expenses_total();init_estimates_total();init_items_sortable();$(".settings-textarea-merge-field").on("click",function(n){n.preventDefault();var i=$(this).text().trim(),t=$('textarea[name="settings['+$(this).data("to")+']"]');t.val(t.val()+"\n"+i)});$("body").hasClass("estimates-pipeline")&&(g=$('input[name="estimateid"]').val(),estimate_pipeline_open(g));$("body").hasClass("proposals-pipeline")&&(nt=$('input[name="proposalid"]').val(),proposal_pipeline_open(nt));$("body").on("submit","._transaction_form",function(){calculate_total();$("body").find("#items-warning").remove();var n=$(this).find("table.items"),t=n.find(".main");return t.find('[name="description"]').length&&t.find('[name="description"]').val().trim().length>0&&t.find('[name="rate"]').val().trim().length>0?(n.before('<div class="alert alert-warning mbot20" id="items-warning">'+app.lang.item_forgotten_in_preview+'<i class="fa fa-angle-double-down pointer pull-right fa-2x" style="margin-top:-4px;" onclick="add_item_to_table(\'undefined\',\'undefined\',undefined); return false;"><\/i><\/div>'),$("html,body").animate({scrollTop:$("#items-warning").offset().top}),!1):n.length&&n.find(".item").length===0?(n.before('<div class="alert alert-warning mbot20" id="items-warning">'+app.lang.no_items_warning+"<\/div>"),$("html,body").animate({scrollTop:$("#items-warning").offset().top}),!1):(reorder_items(),$('select[name="currency"]').prop("disabled",!1),$('select[name="project_id"]').prop("disabled",!1),$('input[name="date"]').prop("disabled",!1),$(this).find(".transaction-submit").prop("disabled",!0),!0)});$("body").on("click",".transaction-submit",function(){var t=$(this),n=t.parents("form._transaction_form");n.valid()&&(t.hasClass("save-as-draft")?n.append(hidden_input("save_as_draft","true")):t.hasClass("save-and-send")?n.append(hidden_input("save_and_send","true")):t.hasClass("save-and-record-payment")?n.append(hidden_input("save_and_record_payment","true")):t.hasClass("save-and-send-later")&&n.append(hidden_input("save_and_send_later","true")));n.submit()});$("body").on("submit","#sales-notes",function(){var n=$(this);if(n.find('textarea[name="description"]').val()!=="")return $.post(n.attr("action"),$(n).serialize()).done(function(t){n.find('textarea[name="description"]').val("");n.hasClass("estimate-notes-form")?get_sales_notes(t,"estimates"):n.hasClass("invoice-notes-form")?get_sales_notes(t,"invoices"):n.hasClass("proposal-notes-form")?get_sales_notes(t,"proposals"):n.hasClass("contract-notes-form")&&get_sales_notes(t,"contracts")}),!1});$("body").on("change",'input[name="show_quantity_as"]',function(){$("body").find("th.qty").html($(this).data("text"))});$("body").on("change",'div.credit_note input[name="date"]',function(){do_prefix_year($(this).val())});$("body").on("change",'div.invoice input[name="date"], div.estimate input[name="date"], div.proposal input[name="date"]',function(){var t=$(this).val(),n,i;(do_prefix_year(t),$('input[name="isedit"]').length>0)||(n="duedate",i=admin_url+"invoices/get_due_date",$("body").find("div.estimate").length>0?(i=admin_url+"estimates/get_due_date",n="expirydate"):$("body").find("div.proposal").length>0&&(i=admin_url+"proposals/get_due_date",n="open_till"),t===""&&$('input[name="'+n+'"]').val(""),t!==""&&$.post(i,{date:t}).done(function(t){t&&$('input[name="'+n+'"]').val(t)}))});$("#sales_attach_file").on("hidden.bs.modal",function(){$("#sales_uploaded_files_preview").empty();$(".dz-file-preview").empty()});typeof Dropbox!="undefined"&&$("#dropbox-chooser-sales").length>0&&document.getElementById("dropbox-chooser-sales").appendChild(Dropbox.createChooseButton({success:function(n){salesExtenalFileUpload(n,"dropbox")},linkType:"preview",extensions:app.options.allowed_files.split(",")}));$("#sales-upload").length>0&&new Dropzone("#sales-upload",appCreateDropzoneOptions({sending:function(n,t,i){i.append("rel_id",$("body").find('input[name="_attachment_sale_id"]').val());i.append("type",$("body").find('input[name="_attachment_sale_type"]').val())},success:function(n,t){var r,u,f,i;t=JSON.parse(t);r=$("body").find('input[name="_attachment_sale_type"]').val();u="download/file/sales_attachment/";f="delete_"+r+"_attachment";r=="estimate"?$("body").hasClass("estimates-pipeline")?estimate_pipeline_open(t.rel_id):init_estimate(t.rel_id):r=="proposal"?$("body").hasClass("proposals-pipeline")?proposal_pipeline_open(t.rel_id):init_proposal(t.rel_id):typeof window["init_"+r]=="function"&&window["init_"+r](t.rel_id);i="";(t.success===!0||t.success=="true")&&(i+='<div class="display-block sales-attach-file-preview" data-attachment-id="'+t.attachment_id+'">',i+='<div class="col-md-10">',i+='<div class="pull-left"><i class="attachment-icon-preview fa fa-file-o"><\/i><\/div>',i+='<a href="'+site_url+u+t.key+'" target="_blank">'+t.file_name+"<\/a>",i+='<p class="text-muted">'+t.filetype+"<\/p>",i+="<\/div>",i+='<div class="col-md-2 text-right">',i+='<a href="#" class="text-danger" onclick="'+f+"("+t.attachment_id+'); return false;"><i class="fa fa-times"><\/i><\/a>',i+="<\/div>",i+='<div class="clearfix"><\/div><hr/>',i+="<\/div>",$("#sales_uploaded_files_preview").append(i))}}));$("body").on("click",".invoice-send-to-client",function(n){n.preventDefault();$("#invoice_send_to_client_modal").modal("show")});$("body").on("click",".estimate-send-to-client",function(n){n.preventDefault();$("#estimate_send_to_client_modal").modal("show")});$("body").on("click",".close-send-template-modal",function(){$("#estimate_send_to_client_modal").modal("hide");$("#proposal_send_to_customer").modal("hide")});$("body").on("change","#include_shipping",function(){var n=$("#shipping_details");$(this).prop("checked")===!0?n.removeClass("hide"):n.addClass("hide")});$("body").on("click",".save-shipping-billing",function(){init_billing_and_shipping_details()});$("body").on("change",'select[name="currency"]',function(){init_currency()});$("body").on("change",'input[name="adjustment"],select.tax',function(){calculate_total()});$("body").on("click",".discount-total-type",function(n){n.preventDefault();$("#discount-total-type-dropdown").find(".discount-total-type").removeClass("selected");$(this).addClass("selected");$(".discount-total-type-selected").html($(this).text());$(this).hasClass("discount-type-percent")?($(".input-discount-fixed").addClass("hide").val(0),$(".input-discount-percent").removeClass("hide")):($(".input-discount-fixed").removeClass("hide"),$(".input-discount-percent").addClass("hide").val(0),$("#discount_percent-error").remove());calculate_total()});$("body").on("change",'select[name="discount_type"]',function(){$(this).val()===""&&$('input[name="discount_percent"]').val(0);calculate_total()});$("body").on("change",'input[name="discount_percent"],input[name="discount_total"]',function(){if($('select[name="discount_type"]').val()===""&&$(this).val()!=0)return alert("You need to select discount type"),$("html,body").animate({scrollTop:0},"slow"),$("#wrapper").highlight($('label[for="discount_type"]').text()),setTimeout(function(){$("#wrapper").unhighlight()},3e3),!1;$(this).valid()===!0&&calculate_total()});$("body").on("change",".invoice #project_id",function(){var n=$(this).selectpicker("val"),t;n!==""?requestGetJSON("tasks/get_billable_tasks_by_project/"+n).done(function(t){_init_tasks_billable_select(t,n)}):(t=$("#clientid").selectpicker("val"),t!==""?requestGetJSON("tasks/get_billable_tasks_by_customer_id/"+t).done(function(n){_init_tasks_billable_select(n)}):_init_tasks_billable_select([],""))});$("body").on("change",'select[name="task_select"]',function(){$(this).selectpicker("val")!==""?add_task_to_preview_as_item($(this).selectpicker("val")):""});$("body").on("change",'select[name="paymentmode"]',function(){var n=$(".do_not_redirect");$.isNumeric($(this).val())?n.addClass("hide"):n.removeClass("hide")});$("body").on("change",'.f_client_id select[name="clientid"]',function(){var r=$(this).val(),t=$('select[name="project_id"]'),u=t.html("").clone(),i=$(".projects-wrapper"),n;if(t.selectpicker("destroy").remove(),t=u,$("#project_ajax_search_wrapper").append(u),init_ajax_project_search_by_customer_id(),clear_billing_and_shipping_details(),!r)return $("#merge").empty(),$("#expenses_to_bill").empty(),$("#invoice_top_info").addClass("hide"),i.addClass("hide"),!1;n=$("body").find('input[name="merge_current_invoice"]').val();n=typeof n=="undefined"?"":n;requestGetJSON("invoices/client_change_data/"+r+"/"+n).done(function(n){var o,r,u,f,e;$("#merge").html(n.merge_info);o=$("#expenses_to_bill");o.length===0?n.expenses_bill_info="":o.html(n.expenses_bill_info);n.merge_info!==""||n.expenses_bill_info!==""?$("#invoice_top_info").removeClass("hide"):$("#invoice_top_info").addClass("hide");for(r in billingAndShippingFields)billingAndShippingFields[r].indexOf("billing")>-1&&(billingAndShippingFields[r].indexOf("country")>-1?$('select[name="'+billingAndShippingFields[r]+'"]').selectpicker("val",n.billing_shipping[0][billingAndShippingFields[r]]):billingAndShippingFields[r].indexOf("billing_street")>-1?$('textarea[name="'+billingAndShippingFields[r]+'"]').val(n.billing_shipping[0][billingAndShippingFields[r]]):$('input[name="'+billingAndShippingFields[r]+'"]').val(n.billing_shipping[0][billingAndShippingFields[r]]));empty(n.billing_shipping[0].shipping_street)||$('input[name="include_shipping"]').prop("checked",!0).change();for(u in billingAndShippingFields)billingAndShippingFields[u].indexOf("shipping")>-1&&(billingAndShippingFields[u].indexOf("country")>-1?$('select[name="'+billingAndShippingFields[u]+'"]').selectpicker("val",n.billing_shipping[0][billingAndShippingFields[u]]):billingAndShippingFields[u].indexOf("shipping_street")>-1?$('textarea[name="'+billingAndShippingFields[u]+'"]').val(n.billing_shipping[0][billingAndShippingFields[u]]):$('input[name="'+billingAndShippingFields[u]+'"]').val(n.billing_shipping[0][billingAndShippingFields[u]]));init_billing_and_shipping_details();f=n.client_currency;e=$("body").find('.accounting-template select[name="currency"]');f=parseInt(f);f!=0?e.val(f):e.val(e.data("base"));_init_tasks_billable_select(n.billable_tasks,t.selectpicker("val"));n.customer_has_projects===!0?i.removeClass("hide"):i.addClass("hide");e.selectpicker("refresh");init_currency()})});$("body").find('input[name="isedit"]').length===0&&$('.f_client_id select[name="clientid"]').change();$("body").on("click","#get_shipping_from_customer_profile",function(n){var t,i;(n.preventDefault(),t=$("#include_shipping"),t.prop("checked")===!1&&(t.prop("checked",!0),$("#shipping_details").removeClass("hide")),i=$('select[name="clientid"]').val(),i!=="")&&requestGetJSON("clients/get_customer_billing_and_shipping_details/"+i).done(function(n){$('textarea[name="shipping_street"]').val(n[0].shipping_street);$('input[name="shipping_city"]').val(n[0].shipping_city);$('input[name="shipping_state"]').val(n[0].shipping_state);$('input[name="shipping_zip"]').val(n[0].shipping_zip);$('select[name="shipping_country"]').selectpicker("val",n[0].shipping_country)})});typeof accounting!="undefined"&&(accounting.settings.currency.precision=app.options.decimal_places,accounting.settings.number.thousand=app.options.thousand_separator,accounting.settings.number.decimal=app.options.decimal_separator,accounting.settings.number.precision=app.options.decimal_places,calculate_total());$("body").on("change",'input[name="invoices_to_merge[]"]',function(){var t=$(this).prop("checked"),n=$(this).val();t===!0?requestGetJSON("invoices/get_merge_data/"+n).done(function(t){$.each(t.items,function(t,i){i.rel_type!==""&&(i.rel_type=="task"?$('input[name="task_id"]').val(i.item_related_formatted_for_input):i.rel_type=="expense"&&$('input[name="expense_id"]').val(i.item_related_formatted_for_input));_set_item_preview_custom_fields_array(i.custom_fields);add_item_to_table(i,"undefined",n)})}):$("body").find('[data-merge-invoice="'+n+'"]').remove()});$("body").on("change",'input[name="bill_expenses[]"]',function(){var t=$(this).prop("checked"),n=$(this).val();t===!0?requestGetJSON("invoices/get_bill_expense_data/"+n).done(function(t){$('input[name="expense_id"]').val(n);add_item_to_table(t,"undefined","undefined",n)}):($("body").find('[data-bill-expense="'+n+'"]').remove(),$("body").find('#billed-expenses input[value="'+n+'"]').remove())});$("body").on("change",".invoice_inc_expense_additional_info input",function(){var n=$(this).attr("data-content"),i,t=$("[data-bill-expense="+$(this).attr("data-id")+"] .item_long_description");current_desc_val=t.val();current_desc_val=current_desc_val.trim();n!==""&&($(this).prop("checked")===!0?(i=current_desc_val+"\n"+n,t.val(i.trim())):(t.val(current_desc_val.replace("\n"+n,"")),t.val(current_desc_val.replace(n,""))))})});$(document).keyup(function(n){n.keyCode==27&&($(".popup-wrapper").is(":visible")&&$(".popup-wrapper").find(".system-popup-close").click(),$("#search-history").is(":visible")&&$("#search-history").removeClass("display-block"))});$("#newsfeed").scroll(function(n){var t=$(n.currentTarget);t[0].scrollHeight-t.scrollTop()==t.outerHeight()&&load_newsfeed();$("#newsfeed .close_newsfeed").css("top",$(this).scrollTop()+20+"px")})